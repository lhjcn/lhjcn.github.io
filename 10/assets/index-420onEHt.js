const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DatabaseForOSS-BfIAQqPx.js","./ali-oss-Ci4CXxfL.js","./vendor-C-jb08-1.js","./@vue-BYKpmgQC.js","./element-plus-SGNFsUZO.js","./@element-plus-DmmXDu5M.js","./element-plus-D5Myz9W0.css","./cos-js-sdk-v5-p1FWqW2f.js","./IndexPage-D8HG9zdO.js","./local-DhpgDmJL.js","./logo-B_J9w6Yt.js","./IndexPage-BmoU5vaD.css","./LoginPage-_9qS6L_m.js","./LoginPage-BXHbwOK-.css","./NotePage-DDs4d0XB.js","./aieditor-YMkC0OXY.js","./aieditor-BiTnkUsi.css","./NotePage-C5m58U6X.css"])))=>i.map(i=>d[i]);
var et=Object.defineProperty;var tt=(r,e,t)=>e in r?et(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var S=(r,e,t)=>tt(r,typeof e!="symbol"?e+"":e,t);import{r as d,L as Ue,d as q,t as Z,o as x,v as b,x as Ge,c as G,D as P,a as O,B as R,u as f,j as Ke,R as ie,G as st,z as $,O as rt,a0 as at,F as Je,H as ot,ac as it,am as nt}from"./@vue-BYKpmgQC.js";import{E as N,a as Ve,b as K,c as Ee,d as Te,v as je,e as Ne,f as xe,g as lt,h as ut,i as ct,z as dt,j as ft}from"./element-plus-SGNFsUZO.js";import{M as D,N as Q,O as H,P as be,Q as ze,R as gt,U as ht,p as mt,V as pt}from"./vendor-C-jb08-1.js";import{C as yt}from"./cos-js-sdk-v5-p1FWqW2f.js";import"./@element-plus-DmmXDu5M.js";import"./ali-oss-Ci4CXxfL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var ne=(r=>(r.ASC="ascending",r.DESC="descending",r))(ne||{}),U=(r=>(r[r.NORMAL=0]="NORMAL",r[r.DELETED=1]="DELETED",r))(U||{}),M=(r=>(r.AUTO="auto",r.LIGHT="light",r.DARK="dark",r))(M||{}),He=(r=>(r[r.CARD=0]="CARD",r[r.TABLE=1]="TABLE",r))(He||{}),y=(r=>(r.NO_LOGIN="初始化",r.LOGGED="已登录",r.WAIT_INIT="待初始化",r.UNLOCKED="已解锁",r))(y||{}),j=(r=>(r.STANDARD="standard",r.GESTURE="gesture",r))(j||{});const W=()=>{let r="";try{r+=(Intl.DateTimeFormat().resolvedOptions().timeZone||"")+","}catch{}try{r+=(window.navigator.languages.join(",")||"")+",",r+=(window.navigator.hardwareConcurrency||"")+","}catch{}try{r+=(window.getComputedStyle(document.documentElement).fontFamily||"")+","}catch{}try{let e=document.createElement("canvas").getContext("webgl2");if(e){let t=e.getExtension("WEBGL_debug_renderer_info");t&&(r+=(e.getParameter(t.UNMASKED_RENDERER_WEBGL)||"")+",")}}catch{}return D.MD5(r).toString()},Ae=(r,e)=>{try{return!!L(r,e)}catch{return!1}};async function wt(r){const s=r.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s+/g,""),a=Uint8Array.from(atob(s),o=>o.charCodeAt(0));return crypto.subtle.importKey("spki",a.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])}async function St(r,e){const t=await wt(r),s=new TextEncoder().encode(e);let a=await crypto.subtle.encrypt({name:"RSA-OAEP"},t,s);function o(i){const l=new Uint8Array(i);let u="";for(let n=0;n<l.length;n++)u+=String.fromCharCode(l[n]);return btoa(u)}return o(a)}const E=(r,e)=>{const t=D.enc.Utf8.parse(e),s=D.enc.Utf8.parse(D.MD5(r).toString()),a=D.enc.Utf8.parse(D.MD5("password-xl").toString());return D.AES.encrypt(t,s,{iv:a,mode:D.mode.CBC,padding:D.pad.Pkcs7}).ciphertext.toString()},L=(r,e)=>{let t=D.enc.Hex.parse(e),s=D.enc.Base64.stringify(t);const a=D.enc.Utf8.parse(D.MD5(r).toString()),o=D.enc.Utf8.parse(D.MD5("password-xl").toString());return D.AES.decrypt(s,a,{iv:o,mode:D.mode.CBC,padding:D.pad.Pkcs7}).toString(D.enc.Utf8).toString()},Ce=r=>D.MD5(r).toString(),Pe=r=>{const e={},t=[];let s=0;for(let a=0;a<r.length;a++){const o=[];for(const i in r[a])e.hasOwnProperty(i)||(e[i]=s++),o[e[i]]=r[a][i];t.push(o)}return{keys:e,dataArray:t}},vt=r=>{const e=[];for(let t=0;t<r.dataArray.length;t++){const s=r.dataArray[t],a={};for(const o in r.keys){const i=s[r.keys[o]];i!==void 0&&(a[o]=i)}e.push(a)}return e},Dt="modulepreload",bt=function(r,e){return new URL(r,e).href},Fe={},oe=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(t.map(n=>{if(n=bt(n,s),n in Fe)return;Fe[n]=!0;const h=n.endsWith(".css"),v=h?'[rel="stylesheet"]':"";if(!!s)for(let T=i.length-1;T>=0;T--){const F=i[T];if(F.href===n&&(!h||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${v}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":Dt,h||(g.as="script"),g.crossOrigin="",g.href=n,u&&g.setAttribute("nonce",u),document.head.appendChild(g),h)return new Promise((T,F)=>{g.addEventListener("load",T),g.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${n}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};class Ct{constructor(){S(this,"fileNames",{store:"password-xl/store.json",setting:"password-xl/setting.json",note:"password-xl/note.json"});S(this,"fileEtags",{});S(this,"cosClient",null);S(this,"region","");S(this,"bucket","")}async login(e){return this.cosClient=new yt({SecretId:e.secretId,SecretKey:e.secretKey}),this.region=e.region,this.bucket=e.bucket,Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((s,a)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");let o=e.name.split(".").pop(),i="/images/"+t+"/"+Ot()+"."+o;this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:i,Body:e},(l,u)=>{l?(N.error({title:"系统异常",message:this.errorDispose(l)}),a({status:!1,message:this.errorDispose(l)})):s("https://"+this.bucket+".cos."+this.region+".myqcloud.com"+i)})})}async getFile(e){return new Promise((t,s)=>{if(!this.cosClient)throw new Error("cos getFile 存储引擎不存在");this.cosClient.getObject({Bucket:this.bucket,Region:this.region,Key:e},(a,o)=>{if(o){this.updateEtag(e,o.ETag),t(JSON.parse(o.Body.toString()));return}a&&a.statusCode===404?t(""):(N.error({title:"系统异常",message:this.errorDispose(a)}),s({status:!1,message:this.errorDispose(a)}))})})}async uploadFile(e,t){return new Promise(async(s,a)=>{if(!this.cosClient)throw new Error("cos uploadFile 存储引擎不存在");if(!await this.checkEtag(e)){Ve({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{location.reload()}});return}this.cosClient.putObject({Bucket:this.bucket,Region:this.region,Key:e,Body:JSON.stringify(t)},(i,l)=>{i?(N.error({title:"系统异常",message:this.errorDispose(i)}),a({status:!1,message:this.errorDispose(i)})):(this.updateEtag(e,l.ETag),s({status:!0}))})})}async deleteFile(e){return new Promise((t,s)=>{if(!this.cosClient)throw new Error("cos deleteFile 存储引擎不存在");this.cosClient.deleteObject({Bucket:this.bucket,Region:this.region,Key:e},a=>{a?(N.error({title:"系统异常",message:this.errorDispose(a)}),s({status:!1,message:this.errorDispose(a)})):t({status:!0})})})}errorDispose(e){let t={"CORS blocked or network error":"有可能是存储桶（bucket）不存在、地域（region）错误、跨域配置错误","Access Denied.":"该账号无存储桶（bucket）权限或存储桶错误",'Bucket should format as "test-1250000000".':"存储桶（bucket）格式错误"};if(e){if(e.code==="InvalidAccessKeyId")return"账户（secretId）无效";if(e.code==="SignatureDoesNotMatch")return"密钥（secretKey）无效";if(e.code==="Error"){let s=t[e.message];return s||e.message}}return"COS登录异常-未知原因"}getEtag(e){return new Promise(async t=>{if(!this.cosClient)throw new Error("cos getEtag 存储引擎不存在");this.cosClient.headObject({Bucket:this.bucket,Region:this.region,Key:e},function(s,a){t(a.ETag)})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){this.fileEtags[e]=t}}const J=Q("settingStore",{state:()=>({visSetting:!1,setting:{autoGeneratePassword:!0,customFields:[],easyConfuseChat:"0OoIil",showLabelCard:!0,enableAiAdd:!0,showFavoriteCard:!0,enableRecycleBin:!1,enableShortcutKey:!0,generateRule:{length:16,lowercase:!0,number:!0,symbol:!0,uppercase:!0},showTimeForTable:"no",showLabelForTable:!0,showStrength:!0,sortOrder:ne.DESC,sortField:"addTime",timeoutLock:0,verifyShowGesture:!0,passwordDisplayMode:He.CARD,autoLogin:!0,autoUnlock:!1,showPasswordStatistics:!1,showNote:!1,bgColors:["rgb(255,0,0)","rgb(255,136,0)","rgb(115,255,0)","rgb(0,208,255)","rgb(95,0,255)","rgb(178,0,255)","rgb(0,0,0)"],dynamicBackground:!0,passwordColor:!1}})}),ee=Q("refStore",{state:()=>({verifyPasswordRef:d(),passwordFormRef:d(),cancelAccountRef:d(),settingRef:d(),labelTreeRef:d(),labelTreeDivRef:d(),setPasswordRef:d(),recycleBinRef:d(),backupAndRecoveryRef:d(),fastLoginRef:d(),aiAddPasswordRef:d(),labelDrawer:d(),favoriteDrawer:d(),tourRef:d(),showPasswordRef:d(),exportExcelRef:d(),importExcelRef:d(),contextmenuRef:d(),createPasswordBtnRef:d(),aiCreatePasswordBtnRef:d(),passwordFormFormRef:d(),passwordFormTitleRef:d(),passwordFormGenerateBtnRef:d(),passwordFormGenerateRuleRef:d(),passwordFormSaveBtnRef:d(),displayModeCardRef:d(),displayModeTableRef:d(),searchInputRef:d(),noteTitleRef:d()})});class Pt{constructor(){S(this,"fileNames",{store:"store.json",setting:"setting.json",note:"note.json"});S(this,"fileEtags",{});S(this,"serverUrl","");S(this,"token","")}async login(e){return this.serverUrl=e.serverUrl,new Promise(t=>{H.post(this.serverUrl+"/login",{username:e.username,password:e.password}).then(s=>{if(s.status!==200){t({status:!1,message:s.statusText});return}if(s.data.code!==200){t({status:!1,message:s.data.message});return}this.token=s.data.data,t({status:!0})}).catch(s=>{t({status:!1,message:this.errorDispose(s.message)})})})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise((s,a)=>{const o=new FormData;o.append("file",e),H.post(this.serverUrl+"/uploadImage/"+t,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.token}`}}).then(i=>{s(this.serverUrl+"/image"+i.data.data.objectKey)}).catch(i=>{a(i)})})}async getFile(e){return new Promise((t,s)=>{H.post(this.serverUrl+"/get",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){N.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.data.code===404){t("");return}if(a.status===200){this.updateEtag(e,a.data.data.etag),t(a.data.data.content);return}s({status:!1,message:a.statusText})}).catch(a=>{N.error({title:"系统异常",message:a.message}),s({status:!1,message:a})})})}async uploadFile(e,t){return new Promise(async(s,a)=>{if(!await this.checkEtag(e)){Ve({title:"文件同步异常",message:"当前密码列表已被其他客户端更新，请刷新页面",showCancelButton:!1,showConfirmButton:!0,closeOnPressEscape:!1,showClose:!1,closeOnClickModal:!1,confirmButtonText:"刷新",callback:()=>{location.reload()}});return}H.post(this.serverUrl+"/put",{key:e,content:t},{headers:{Authorization:`Bearer ${this.token}`}}).then(i=>{if(i.data.code===500){N.error({title:"系统异常",message:this.errorDispose(i.data.message)}),a({status:!1,message:i.data.message});return}if(i.status===200){this.updateEtag(e,i.data.data.etag),s({status:!0});return}a({status:!1,message:i.statusText})}).catch(i=>{N.error({title:"系统异常",message:i.message}),a({status:!1,message:i})})})}async deleteFile(e){return new Promise((t,s)=>{H.post(this.serverUrl+"/delete",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){N.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.status===200){t({status:!0});return}s({status:!1,message:a.statusText})}).catch(a=>{s({status:!1,message:a})})})}errorDispose(e){return e.indexOf("Invalid URL")!==-1?"无效的服务地址":{"IORuntimeException: IOException: Permission denied":"服务端文件权限不足","Network Error":"无法连接到服务器"}[e]||e}getEtag(e){return new Promise(async(t,s)=>{H.post(this.serverUrl+"/getEtag",{key:e},{headers:{Authorization:`Bearer ${this.token}`}}).then(a=>{if(a.data.code===500){N.error({title:"系统异常",message:this.errorDispose(a.data.message)}),s({status:!1,message:a.data.message});return}if(a.status===200){t(a.data.data.etag);return}s({status:!1,message:a.statusText})}).catch(a=>{N.error({title:"系统异常",message:a.message}),s({status:!1,message:a})})})}async checkEtag(e){if(!this.fileEtags[e])return Promise.resolve(!0);let t=await this.getEtag(e);return this.fileEtags[e]===t}async updateEtag(e,t){this.fileEtags[e]=t}}class At{constructor(){S(this,"fileNames",{store:"store.json",setting:"setting.json",note:"password-xl/note.json"})}async login(e){return Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){return new Promise(async s=>{const a=await e.arrayBuffer();let o=await window.electronAPI.uploadImage(e.name,a,t);s(o)})}async getFile(e){return new Promise(async t=>{let s=await window.electronAPI.getFile(e);t(s||"")})}async uploadFile(e,t){return new Promise(async s=>{window.electronAPI.uploadFile(e,t),s({status:!0})})}async deleteFile(e){return new Promise(t=>{window.electronAPI.deleteFile(e),t({status:!0})})}}class Et{constructor(){S(this,"fileNames",{store:"store.json",setting:"setting.json",note:"note.json"})}async login(e){return Promise.resolve({status:!0})}async getStoreData(){return this.getFile(this.fileNames.store)}async getTreeNoteData(){return this.getFile(this.fileNames.note)}async setNoteData(e){return this.uploadFile(this.fileNames.note,e)}async getData(e){return this.getFile(e)}async setData(e,t){return this.uploadFile(e,t)}async setStoreData(e){return this.uploadFile(this.fileNames.store,e)}async deleteStoreData(){return this.deleteFile(this.fileNames.store)}async getSettingData(){return this.getFile(this.fileNames.setting)}async setSettingData(e){return this.uploadFile(this.fileNames.setting,e)}async deleteSettingData(){return this.deleteFile(this.fileNames.setting)}async deleteData(e){return this.deleteFile(e)}async uploadImage(e,t){throw new Error("安卓本地存储暂不支持上传图片，请改用其他存储方式")}async getFile(e){return new Promise(async t=>{let s=await window.androidAPI.getFile(e);t(s||"")})}async uploadFile(e,t){return new Promise(async s=>{window.androidAPI.uploadFile(e,t),s({status:!0})})}async deleteFile(e){return new Promise(t=>{window.androidAPI.deleteFile(e),t({status:!0})})}}const le=Q("loginStore",{state:()=>({loginType:"",logging:!1,loggingText:"正在登录...",loginForm:null}),actions:{startLogin:async function(r,e){return new Promise(async t=>{let s=null;if(r.loginType==="oss"){const l=await oe(()=>import("./DatabaseForOSS-BfIAQqPx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url);s=new l.DatabaseForOSS}else if(r.loginType==="cos")s=new Ct;else if(r.loginType==="private")s=new Pt;else if(r.loginType==="electron")s=new At;else if(r.loginType==="android")s=new Et;else{t(!1);return}this.loginType=r.loginType;let a=I();if(a.loading("自动登录中..."),!(await s.login(r)).status){a.unloading(),t(!1);return}let i=await a.passwordManager.login(s).catch(()=>t(!1));if(!i||!i.status){a.unloading(),t(!1);return}if(a.serviceStatus===y.LOGGED){let l=a.passwordManager.unlock(e);a.unloading(),t(l)}else a.serviceStatus===y.WAIT_INIT&&(a.unloading(),t(!0));this.loginForm=r})},autoLogin(){return new Promise(async r=>{try{let e=localStorage.getItem("loginInfo");if(!e){r(!1);return}let t=L(W(),e);if(!t){r(!1);return}let s=JSON.parse(t),a=await this.getMainPassword(s),o=JSON.parse(L(a,s.loginForm)),i=await this.startLogin(o,a);r(i)}catch{r(!1)}})},async getMainPassword(r){let e=localStorage.getItem("mainPassword");if(e){let t=L(W(),e);if(Ae(t,r.loginForm))return t}return await ee().verifyPasswordRef.getAndVerify(t=>Ae(t,r.loginForm),r.mainPasswordType)},setAutoLoginInfo(r){const e=J();let t=sessionStorage.getItem("loginForm");if(e.setting.autoLogin&&t){let s=L(W(),t),a={mainPasswordType:I().mainPasswordType,loginForm:E(r,s)};localStorage.setItem("loginInfo",E(W(),JSON.stringify(a))),sessionStorage.removeItem("loginForm")}if(e.setting.autoUnlock){let s=W();localStorage.setItem("mainPassword",E(s,r))}},updateRememberLoginInfo(r,e){try{let t=localStorage.getItem("loginInfo");if(!t)return!1;let s=W(),a=L(s,t);if(!a)return!1;let o=JSON.parse(a),i=I().mainPasswordType;return o.mainPasswordType=i,o.loginForm=E(e,L(r,o.loginForm)),localStorage.setItem("loginInfo",E(s,JSON.stringify(o))),!0}catch{return!1}}}}),Tt=Q("noteStore",{state:()=>({noteData:{noteTree:[],currentNote:""}}),actions:{getTreeNoteById(r,e=this.noteData.noteTree){for(const t of e){if(t.id===r)return t;if(t.children){const s=this.getTreeNoteById(r,t.children);if(s)return s}}return null}}});class Oe{constructor(){S(this,"storeData",null);S(this,"treeNoteData",null);S(this,"databaseClient",null);S(this,"passwordStore",I());S(this,"loginStore",le());S(this,"settingStore",J());S(this,"noteStore",Tt());S(this,"refStore",ee());S(this,"nodeCacheMap",new Map);S(this,"serviceStatusAssert",e=>{if(this.passwordStore.serviceStatus!==e)throw new Error("当前服务状态不允许该操作："+this.passwordStore.serviceStatus)});S(this,"getData",e=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");let t=this.nodeCacheMap.get(e);return t?Promise.resolve(t):new Promise(s=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull getData");this.databaseClient.getData(e).then(a=>{this.nodeCacheMap.set(e,a),s(a)})})});S(this,"setData",(e,t)=>new Promise(s=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.setData(e,t).then(a=>{this.nodeCacheMap.set(e,t),s(a)})}));S(this,"delData",e=>new Promise(t=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");this.databaseClient.deleteData(e).then(s=>{t(s)})}));S(this,"uploadImage",(e,t)=>{if(!this.databaseClient)throw new Error("系统异常databaseClient isnull setData");return this.databaseClient.uploadImage(e,t)})}async login(e){return new Promise(async(t,s)=>{try{const[a,o,i]=await Promise.all([e.getStoreData(),e.getSettingData(),e.getTreeNoteData()]);a&&(this.storeData=JSON.parse(a),this.storeData&&this.storeData.mainPasswordType&&(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType)),o&&Object.assign(this.settingStore.setting,JSON.parse(o)),i&&(this.treeNoteData=JSON.parse(i)),this.databaseClient=e,this.passwordStore.passwordManager=this,this.storeData&&this.storeData.passwordData?(this.passwordStore.mainPasswordType=this.storeData.mainPasswordType,this.passwordStore.setServiceStatus(y.LOGGED)):this.passwordStore.setServiceStatus(y.WAIT_INIT),t({status:!0})}catch(a){s({status:!1,message:a})}})}async initMainPassword(e,t){if(this.serviceStatusAssert(y.WAIT_INIT),this.passwordStore.mainPassword)throw new Error("密码已存在，不允许初始化");if(!this.databaseClient)throw new Error("系统异常");try{this.passwordStore.mainPassword=t,this.storeData={passwordData:E(t,JSON.stringify(Pe([]))),labelData:E(t,JSON.stringify([])),mainPasswordType:e};let s=await this.databaseClient.setStoreData(JSON.stringify(this.storeData));return!s||!s.status?Promise.reject(s):await this.syncSetting()?(this.passwordStore.mainPasswordType=e,this.passwordStore.setServiceStatus(y.UNLOCKED),this.addDemoData(),await this.syncStoreData(),Ue(()=>{var o;(o=this.refStore.tourRef)==null||o.startTour()}),Promise.resolve({status:!0})):Promise.reject({status:!1,message:"设置同步失败"})}catch(s){return Promise.reject(s)}}addDemoData(){let e={id:Date.now(),pid:0,name:"网站",children:[]},t={id:Date.now(),title:"百度（示例数据）",address:"https://www.baidu.com",username:"18395708888",password:$e(this.settingStore.setting.generateRule),remark:"百度网盘、百度贴吧",addTime:Date.now(),updateTime:Date.now(),deleteTime:0,favoriteTime:0,favorite:!0,customFields:[],labels:[e.id],status:U.NORMAL,bgColor:""};this.passwordStore.labelArray.push(e),this.passwordStore.allPasswordArray.push(t)}verifyPassword(e,t){try{return t?!!L(e,t):this.storeData?!!L(e,this.storeData.passwordData):!1}catch{return!1}}async updateMainPassword(e,t,s){if(!this.databaseClient)return Promise.reject();if(this.serviceStatusAssert(y.UNLOCKED),!this.verifyPassword(e))return Promise.reject({status:!1,message:"旧密码错误"});this.passwordStore.loading("密码修改中...");let o=JSON.stringify(this.storeData),i=JSON.stringify(this.treeNoteData);this.storeData={passwordData:E(s,JSON.stringify(Pe(this.passwordStore.allPasswordArray))),labelData:E(s,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:t},this.treeNoteData={noteData:E(s,JSON.stringify(this.noteStore.noteData)),mainPasswordType:t};let l=await this.databaseClient.setStoreData(JSON.stringify(this.storeData)),u=await this.databaseClient.setNoteData(JSON.stringify(this.treeNoteData));return!l||!l.status||!u||!u.status?(this.storeData=JSON.parse(o),this.treeNoteData=JSON.parse(i),N.error({title:"系统异常",message:l.message}),Promise.reject()):(this.passwordStore.mainPasswordType=t,this.passwordStore.mainPassword=s,this.loginStore.updateRememberLoginInfo(e,s),this.passwordStore.unloading(),Promise.resolve({status:!0}))}addPassword(e){this.serviceStatusAssert(y.UNLOCKED);const t={...e,id:Date.now(),addTime:Date.now(),updateTime:Date.now(),status:U.NORMAL};return this.passwordStore.allPasswordArray.unshift(t),this.syncStoreData()}updatePassword(e){this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e.id);return t!==-1?(this.passwordStore.allPasswordArray[t]=e,this.syncStoreData()):Promise.reject("没有找到这个密码："+e.id)}deletePassword(e){if(this.serviceStatusAssert(y.UNLOCKED),this.settingStore.setting.enableRecycleBin){const s=this.passwordStore.allPasswordArray.findIndex(a=>a.id===e);if(s!==-1){if(this.passwordStore.allPasswordArray[s].status===U.DELETED)return this.completelyDeletePassword(e);{let o=this.passwordStore.allPasswordArray[s];return o.deleteTime=Date.now(),o.status=U.DELETED,this.syncStoreData()}}else throw new Error("密码不存在")}else return this.completelyDeletePassword(e)}completelyDeletePassword(e){this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e);if(t!==-1)return this.passwordStore.allPasswordArray.splice(t,1),this.syncStoreData();throw new Error("未找到指定ID的密码")}cancelDeletePassword(e){this.serviceStatusAssert(y.UNLOCKED);const t=this.passwordStore.allPasswordArray.findIndex(s=>s.id===e);if(t!==-1){let s=this.passwordStore.allPasswordArray[t];return s.deleteTime=0,s.status=U.NORMAL,this.syncStoreData()}else throw new Error("未找到指定ID的密码")}unlock(e){if(this.serviceStatusAssert(y.LOGGED),!this.storeData)throw new Error("系统异常");try{if(!Ae(e,this.storeData.passwordData))return K.error("解锁失败-密码错误"),!1;let t=L(e,this.storeData.passwordData),s=L(e,this.storeData.labelData);if(!t||!s)return K.error("解锁失败-密码错误"),!1;if(this.treeNoteData&&this.treeNoteData.noteData){let a=L(e,this.treeNoteData.noteData);a&&(this.noteStore.noteData=JSON.parse(a))}return this.passwordStore.allPasswordArray=vt(JSON.parse(t)),this.passwordStore.labelArray=JSON.parse(s),this.passwordStore.mainPassword=e,this.passwordStore.setServiceStatus(y.UNLOCKED),this.loginStore.setAutoLoginInfo(e),!0}catch{return!1}}lock(){this.passwordStore.mainPassword="",this.passwordStore.allPasswordArray=[],this.passwordStore.labelArray=[],this.passwordStore.setServiceStatus(y.LOGGED),localStorage.removeItem("mainPassword")}emptyRecycle(){return this.passwordStore.allPasswordArray=this.passwordStore.allPasswordArray.filter(e=>e.status!==U.DELETED),this.syncStoreData()}syncSetting(){if([y.NO_LOGIN].includes(this.passwordStore.serviceStatus))throw new Error("当前状态不允许该操作："+this.passwordStore.serviceStatus);if(!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setSettingData(JSON.stringify(this.settingStore.setting))}syncStoreData(){if(this.serviceStatusAssert(y.UNLOCKED),this.storeData={passwordData:E(this.passwordStore.mainPassword,JSON.stringify(Pe(this.passwordStore.allPasswordArray))),labelData:E(this.passwordStore.mainPassword,JSON.stringify(this.passwordStore.labelArray)),mainPasswordType:this.passwordStore.mainPasswordType},!this.databaseClient)throw new Error("系统异常databaseClient isnull syncLabelData");return this.databaseClient.setStoreData(JSON.stringify(this.storeData))}syncNoteData(){if(this.serviceStatusAssert(y.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull syncNoteData");let e={noteData:E(this.passwordStore.mainPassword,JSON.stringify(this.noteStore.noteData)),mainPasswordType:this.passwordStore.mainPasswordType};return this.databaseClient.setNoteData(JSON.stringify(e))}getStoreData(){if(this.storeData)return this.storeData;throw new Error("文件不存在")}getTreeNoteData(){if(this.treeNoteData)return this.treeNoteData;throw new Error("文件不存在")}async closeAccount(){return new Promise(async e=>{if(this.serviceStatusAssert(y.UNLOCKED),!this.databaseClient)throw new Error("系统异常databaseClient isnull closeAccount");let t=await this.databaseClient.deleteStoreData().catch(s=>s);await this.databaseClient.deleteSettingData().catch(s=>s),e(t)})}}const I=Q("passwordStore",{state:()=>({passwordManager:new Oe,allPasswordArray:[],labelArray:[],mainPassword:"",serviceStatus:y.NO_LOGIN,topicMode:M.AUTO,mainPasswordType:j.GESTURE,timeoutLock:null,globalLoading:{vis:!1,timeout:null,content:""},filterCondition:{searchText:"",labelArray:[],favoriteId:0}}),getters:{passwordArray(){const r=J();return this.allPasswordArray.filter(t=>t.status===U.NORMAL).sort((t,s)=>{let a=t[r.setting.sortField],o=s[r.setting.sortField];return r.setting.sortField==="strength"&&(a=ue(t.password),o=ue(s.password)),a>o?r.setting.sortOrder===ne.ASC?1:-1:a<o?r.setting.sortOrder===ne.ASC?-1:1:0})},deletedArray(){return this.allPasswordArray.filter(e=>e.status===U.DELETED).sort((e,t)=>e.deleteTime>t.deleteTime?1:e.deleteTime<t.deleteTime?-1:0)},favoritePasswordArray(){return this.passwordArray.filter(e=>e.favorite).sort((e,t)=>e.favoriteTime>t.favoriteTime?1:e.favoriteTime<t.favoriteTime?-1:0)},visPasswordArray(){return this.passwordArray.filter(e=>{if(this.filterCondition.favoriteId)return e.id===this.filterCondition.favoriteId;let t=!0,s=!0;if(this.filterCondition.searchText){t=!1;const a=[e.title,e.address,e.username,e.password,e.remark].filter(Boolean);if(e.customFields)for(let o=0;o<e.customFields.length;o++)a.push(e.customFields[o].key),a.push(e.customFields[o].val);for(const o of a)if(xt(this.filterCondition.searchText.trim(),o)){t=!0;break}}if(this.filterCondition.labelArray.length){s=!1;const a=new Set(e.labels);for(const o of this.filterCondition.labelArray)if(a.has(o)){s=!0;break}}return t&&s})},isDark(){return this.topicMode===M.DARK}},actions:{setServiceStatus(r){this.serviceStatus=r},logout(){sessionStorage.removeItem("loginForm"),localStorage.removeItem("loginInfo"),localStorage.removeItem("mainPassword"),localStorage.removeItem("topicMode"),this.passwordManager=new Oe,this.allPasswordArray=[],this.labelArray=[],this.mainPassword="",this.serviceStatus=y.NO_LOGIN,I().$resetFields(),le().$resetFields(),J().$resetFields(),location.href=Le()+"#/login"},setTopicMode(r){var e,t,s,a,o,i;if(localStorage.setItem("topicMode",r),r===M.AUTO){let l=window.matchMedia("(prefers-color-scheme: dark)");be().value=l.matches,this.topicMode=l.matches?M.DARK:M.LIGHT,(e=window.electronAPI)==null||e.setTopic("system"),(t=window.androidAPI)==null||t.setTopic("system")}else r===M.DARK?(be().value=!0,this.topicMode=M.DARK,(s=window.electronAPI)==null||s.setTopic(this.topicMode),(a=window.androidAPI)==null||a.setTopic(this.topicMode)):r===M.LIGHT&&(be().value=!1,this.topicMode=M.LIGHT,(o=window.electronAPI)==null||o.setTopic(this.topicMode),(i=window.androidAPI)==null||i.setTopic(this.topicMode))},loading(r){this.globalLoading.timeout=setTimeout(()=>{this.globalLoading.timeout=null,this.globalLoading.vis=!0,this.globalLoading.content=r||"请稍等"},300)},unloading(){this.globalLoading.timeout&&(clearTimeout(this.globalLoading.timeout),this.globalLoading.timeout=null),this.globalLoading.vis=!1},resetTimeoutLock(){this.timeoutLock&&(clearTimeout(this.timeoutLock),this.timeoutLock=null);const r=J();r.setting.timeoutLock!==0&&(this.timeoutLock=setTimeout(()=>{var e,t;if(r.setting.timeoutLock&&this.serviceStatus===y.UNLOCKED&&!r.setting.autoUnlock){this.passwordManager.lock();let s=ee();(e=s.settingRef)==null||e.closeSetting(),(t=s.passwordFormRef)==null||t.closePasswordForm()}},r.setting.timeoutLock*1e3))}}}),gs=r=>r&&/^.*:\/\/.*$/.test(r),X=d(""),ce=()=>{let r=window.innerWidth;return r<768?X.value="xs":r>=768&&r<992?X.value="sm":r>=992&&r<1200?X.value="md":r>=1200&&r<1920?X.value="lg":X.value="xl",X};window.onresize=()=>{ce()};async function Nt(r,e=!1){let t=document.createElement("textarea");t.setAttribute("readonly","readonly"),t.value=r,document.body.appendChild(t),t.setSelectionRange(0,t.value.length),t.select(),document.execCommand("copy"),document.body.removeChild(t),e||K.success("复制成功")}const xt=(r,e)=>{if(!e||!r)return!1;try{const t=r.toLowerCase();if(e.toLowerCase().includes(t))return!0}catch{}return!1},ue=r=>{if(!r)return 0;let e=0;return/[0-9]/.test(r)&&e++,/[a-z]/.test(r)&&e++,/[A-Z]/.test(r)&&e++,/[^0-9a-zA-Z_]/.test(r)&&e++,r.length<6&&e>2&&(e=2),e>3?3:e},ae={uppercase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase:"abcdefghijklmnopqrstuvwxyz",number:"0123456789",symbol:"~!@#$%^&*()_-+=.,;"};function $e(r){let e=[r.uppercase?ae.uppercase:"",r.lowercase?ae.lowercase:"",r.number?ae.number:"",r.symbol?ae.symbol:""].filter(Boolean);const t=J();if(t.setting.easyConfuseChat){const a=t.setting.easyConfuseChat.split("");for(let o=0;o<e.length;o++)for(let i=0;i<a.length;i++)e[o]=e[o].replace(a[i],"")}if(e=e.filter(Boolean),!e.length)return N.error({title:"生成失败",message:"请检查易混淆字符配置"}),"";let s="";for(let a=0;a<r.length;a++){const o=e[a%e.length],i=Math.floor(Math.random()*o.length);s+=o[i]}return s.split("").sort(()=>Math.random()-.5).join("")}const hs=(r,e)=>{if(!r.labels)return[];const t=(a,o)=>{for(let i=0;i<a.length;i++)r.labels.includes(a[i].id)&&o.push(a[i]),a[i].children.length&&t(a[i].children,o)},s=[];return t(e||I().labelArray,s),s},ms=r=>{let e=r.title+`\r
`;if(r.address&&(e+="地址: "+r.address+`\r
`),r.username&&(e+="用户名: "+r.username+`\r
`),r.password&&(e+="密码: "+r.password+`\r
`),r.customFields)for(let t=0;t<r.customFields.length;t++){let s=r.customFields[t];e+=s.key+": "+s.val+`\r
`}r.remark&&(e+=r.remark+`\r
`),e=e.substring(0,e.length-2),Nt(e,!0),K.success("已复制到剪切板")},ps=r=>{let e=ue(r);return["","#F56C6C","#FF9700","#67C23A"][e]},ys=r=>{let e=ue(r);return["","弱密码","中等强度密码","强密码"][e]},Lt=(r,e)=>{const t=new Date(r),s=h=>h<10?"0"+h:h,a=t.getFullYear(),o=s(t.getMonth()+1),i=s(t.getDate()),l=s(t.getHours()),u=s(t.getMinutes()),n=s(t.getSeconds());return e.replace("YYYY",a.toString()).replace("MM",o.toString()).replace("DD",i.toString()).replace("HH",l.toString()).replace("mm",u.toString()).replace("ss",n.toString())},ws=(r,e)=>{const t=e.split(/[^A-Za-z]/),s=r.split(/[^0-9]/),a={};t.forEach((v,m)=>{a[v]=parseInt(s[m],10)});const o=a.YYYY||1970,i=(a.MM||1)-1,l=a.DD||1,u=a.HH||0,n=a.mm||0,h=a.ss||0;return new Date(o,i,l,u,n,h)},Ss=(r,e)=>{let t=Date.now();e.forEach(s=>{let a=r.findIndex(i=>i.id===s.id);if(a===-1){r.push(s);return}let o=r[a];if(kt(s,o)){if(s.labels&&s.labels.length>0){const i=new Set(o.labels);o.labels=s.labels.filter(l=>!i.has(l))}return}s.remark+="（合并恢复 "+Lt(Date.now(),"YYYY-MM-DD HH:mm")+"）",s.id=t++,r.push(s)})},vs=(r,e)=>{let t=Date.now();const s=(i,l)=>{for(const u of i){if(u.id===l)return!0;if(u.children&&u.children.length>0)return s(u.children,l)}return!1},a=(i,l)=>{for(const u of i)if(u.id===l.id&&u.name===l.name&&u.pid===l.pid)return u},o=(i,l)=>{const u=a(i,l);if(!u)s(r,l.id)&&(l.id=t++),i.push(l);else for(const n of l.children)o(u.children,n)};for(const i of e)o(r,i)},Ds=()=>{let r=0;const e=t=>{t.forEach(s=>{r++,s.children&&s.children.length>0&&e(s.children)})};return e(I().labelArray),r},bs=r=>{let e="";const t=(s,a)=>{s.forEach(o=>{r.includes(o.id)&&(e&&(e+="、"),e+=a+"->"+o.name),o.children&&o.children.length>0&&t(o.children,o.name)})};return t(I().labelArray,""),e},Cs=r=>{const e=r.split("、"),t=[];return e.forEach(s=>{const a=s.split("->").map(i=>i.trim());let o;a.forEach((i,l)=>{let u;l===0?(u=t.find(n=>n.name===i&&n.pid===0),!u&&i&&(u={id:Me(),name:i,pid:0,children:[]},t.push(u))):(u=o==null?void 0:o.children.find(n=>n.name===i),u||(u={id:Me(),name:i,pid:o?o.id:0,children:[]},o==null||o.children.push(u))),o=u})}),t},_t=(r,e,t,s,a)=>Math.sqrt((s-r)*(s-r)+(a-e)*(a-e))<=t,Re=r=>r.title+r.username+r.address+r.password+r.remark,kt=(r,e)=>Re(r)===Re(e),Le=()=>{let r=location.origin;return r.startsWith("file://")&&(r+=location.pathname),r},Ps=(r,e)=>{if(!r)return"";let t=r.replace("rgb","rgba");return t=t.replace(")",","+e+")"),t};let It=Date.now();const Me=()=>It++,Ft=r=>Le()+"/#/login?type="+r.loginType+"&autoLogin="+E("password-xl",JSON.stringify(r)),Ot=()=>D.lib.WordArray.random(8).toString(D.enc.Hex),Be={apiServer:"https://ai.password-xl.cn/extractPassword",publicKey:`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvoEZ2yxmxt4mp8ipUmlI
4re+2MLfKcNacXeFOQWh8C3TxumN7I2CLieBX5zRTUfJJalsWlvUjsrXB8NXGjpJ
jqCQWGz+qC4N4UcAwW1olZOM2OBHD+eDtu/GlyBUp9Arf5BblXZcURbMWmh4V821
P7u2ChzxtR/EO107fZGgOcsS7o0LDa9f+Jy7uwhxCJlwoOyC5bCjCZIiayqGRkXx
x75c/i9OcRhovP+oE0eDkwsjBaP5nqUDufxLXUOD0RVOnchlpxS+9Fc58F5nZ4bx
FgAs4rSkgfZ4yc2DyvASc1iu9grjxpLA3ZDmH3L7PLv/ifyFeELlojd2VFzSl0qJ
PwIDAQAB
-----END PUBLIC KEY-----
`},Rt=async r=>{let e=$e({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!1});return new Promise(async(t,s)=>{let a=await St(Be.publicKey,e),o=JSON.stringify({text:r}),i=E(e,o),l={encryptKey:a,data:i};H.post(Be.apiServer,l).then(u=>{let n=u.data;if(n.code!==200){s(n.message);return}let h=L(e,n.data);t(h)}).catch(u=>{s("提取密码失败")})})},Mt={"element-loading-text":"正在处理..."},Bt={style:{"margin-top":"10px"}},Ut=q({__name:"AiAddPassword",setup(r,{expose:e}){const t=ee(),s=d({vis:!1,loading:!1,text:""}),a=()=>{s.value.text="",s.value.loading=!1,s.value.vis=!0},o=()=>{s.value.loading=!0,Rt(s.value.text).then(i=>{t.passwordFormRef.addPasswordForm(),t.passwordFormRef.setPasswordForm(JSON.parse(i)),s.value.vis=!1,s.value.loading=!1,s.value.text=""}).catch(i=>{s.value.loading=!1,N.error({title:"系统异常",message:i})})};return e({show:a}),(i,l)=>{const u=Ee,n=Te,h=Ne,v=xe,m=je;return x(),Z(v,{modelValue:f(s).vis,"onUpdate:modelValue":l[1]||(l[1]=g=>f(s).vis=g),width:["xs","sm"].includes(f(ce)().value)?"95%":"550px",title:"AI创建密码"},{footer:b(()=>[P(h,{disabled:!f(s).text||f(s).loading,plain:"",type:"primary",onClick:o},{default:b(()=>l[4]||(l[4]=[R(" Ai解析 ")])),_:1},8,["disabled"])]),default:b(()=>[Ge((x(),G("div",Mt,[P(u,{type:"info"},{default:b(()=>l[2]||(l[2]=[R(" 你可以直接粘贴包含账号密码信息的字符串，Ai大模型将自动解析您的密码 ")])),_:1}),O("div",Bt,[P(n,{modelValue:f(s).text,"onUpdate:modelValue":l[0]||(l[0]=g=>f(s).text=g),rows:6,placeholder:"请粘贴账号密码到这里",type:"textarea"},null,8,["modelValue"])]),P(u,{size:"small",type:"danger"},{default:b(()=>l[3]||(l[3]=[R(" 您的密码信息将在加密后传输至Ai大模型进行处理，密码信息不会以任何形式进行存储 ")])),_:1})])),[[m,f(s).loading]])]),_:1},8,["modelValue","width"])}}}),Gt={style:{"margin-top":"5px"}},Kt={style:{"margin-top":"10px"}},Jt={style:{"margin-top":"5px"}},Vt=q({__name:"FastLogin",setup(r,{expose:e}){const t=ze(),s=d(""),a=d(!1),o=u=>{if(location.href.indexOf("autoLogin")!==-1||window.electronAPI||window.androidAPI){t.push("/");return}s.value=Ft(u),a.value=!0},i=u=>JSON.parse(L("password-xl",u)),l=()=>{a.value=!1,t.push("/")};return e({fastLoginTip:o,getFastLoginForm:i}),(u,n)=>{const h=Ee,v=Te,m=Ne,g=xe;return x(),Z(g,{modelValue:f(a),"onUpdate:modelValue":n[0]||(n[0]=T=>Ke(a)?a.value=T:null),"append-to-body":!0,fullscreen:["xs","sm"].includes(f(ce)().value),width:"700px"},{header:b(()=>[P(h,{size:"large",style:{"user-select":"none"}},{default:b(()=>n[1]||(n[1]=[O("span",{class:"iconfont icon-verify"},null,-1),R(" 登录成功 ")])),_:1})]),footer:b(()=>[P(m,{type:"primary",onClick:l},{default:b(()=>n[4]||(n[4]=[R("好的")])),_:1})]),default:b(()=>[O("div",null,[P(h,{type:"info"},{default:b(()=>n[2]||(n[2]=[R("以下链接可以自动输入登录信息，您可以保存此链接以防丢失：")])),_:1})]),O("div",Gt,[P(v,{"model-value":f(s),rows:7,type:"textarea"},null,8,["model-value"])]),O("div",Kt,[P(h,{type:"info"},{default:b(()=>n[3]||(n[3]=[R("该链接为password-XL首页地址，您可以收藏：")])),_:1})]),O("div",Jt,[P(v,{"model-value":f(Le)(),readonly:""},null,8,["model-value"])])]),_:1},8,["modelValue","fullscreen"])}}}),We=(r,e)=>{const t=r.__vccOpts||r;for(const[s,a]of e)t[s]=a;return t},jt=We(Vt,[["__scopeId","data-v-4848f215"]]),zt=q({__name:"GesturePassword",props:{ciphertext:{type:String},showGesture:{type:Boolean,default:!0}},emits:["complete","pass","fail"],setup(r,{emit:e}){const t=I(),s=e;let a=r;const o=ie([]),i=ie([]),l=d(),u=d();let n;const h=d(!1),v=d(""),m=d(null),g={pointCellSize:3,cellPointRadio:.33,gesturePointColor:"#cacaca",circleCenterRadio:.25,gesturePointCenterColor:"#409EFF",gesturePointCenterErrorColor:"#F56C6C",lineWidth:12,lineColor:"rgba(64,158,255,0.32)",lineErrorColor:"rgba(245,108,108,0.32)"},T=c=>{B()},F=c=>{B()},_=()=>{let c=i.map(w=>w.id).join();de(c),B()},de=c=>{if(!a.ciphertext){if(i.length=0,c.length<5){K.warning("请至少连接3个点");return}s("complete",Ce(c));return}v.value=t.passwordManager.verifyPassword(c,a.ciphertext)?"pass":"fail",B(),v.value?s("pass",Ce(c)):s("fail",Ce(c)),setTimeout(()=>{v.value="",i.length=0,B()},500)},B=()=>{!l.value||!u.value||(fe(),ge(),Y(),a.showGesture&&(A(),he(),te()))},te=()=>{if(!n)return;let c=[...i];if(m.value&&h.value&&!v.value&&c.push(m.value),!(c.length<2))for(let w=1;w<c.length;w++){let C=c[w-1],k=c[w];n.beginPath(),n.strokeStyle=v.value==="fail"?g.lineErrorColor:g.lineColor,n.lineWidth=g.lineWidth,n.moveTo(C.x,C.y),n.lineTo(k.x,k.y),n.stroke()}},fe=()=>{if(!h.value||v.value==="fail")return;let c=p();if(!c)return;i.find(C=>C.id===c.id)||i.push(c)},ge=()=>{!n||!u.value||n.clearRect(0,0,u.value.width,u.value.height)},he=()=>{if(!(!l.value||!u.value||!n))for(let c=0;c<i.length;c++){let w=i[c];z(w)}},A=()=>{if(!l.value||!u.value||!n||v.value||!m.value)return;let c=p();c&&z(c)},p=()=>{var c;if(!l.value||!u.value||!n||!m.value)return null;for(let w=0;w<o.length;w++){let C=o[w];if(_t(C.x,C.y,C.radius,m.value.x,(c=m.value)==null?void 0:c.y))return C}return null},z=c=>{n&&(n.beginPath(),n.fillStyle=v.value?g.gesturePointCenterErrorColor:g.gesturePointCenterColor,n.arc(c.x,c.y,c.radius*g.circleCenterRadio,0,Math.PI*2),n.fill(),n.beginPath(),n.fillStyle=v.value?g.lineErrorColor:g.lineColor,n.arc(c.x,c.y,c.radius*g.circleCenterRadio*2,0,Math.PI*2),n.fill(),n.beginPath(),n.strokeStyle=v.value?g.gesturePointCenterErrorColor:g.gesturePointCenterColor,n.lineWidth=2,n.arc(c.x,c.y,c.radius,0,Math.PI*2),n.stroke())},Y=()=>{n&&o.forEach(c=>{n&&(n.beginPath(),n.strokeStyle=g.gesturePointColor,n.lineWidth=2,n.arc(c.x,c.y,c.radius,0,Math.PI*2),n.stroke(),n.beginPath(),n.fillStyle=g.gesturePointColor,n.arc(c.x,c.y,c.radius*g.circleCenterRadio,0,Math.PI*2),n.fill())})},me=c=>{h.value=!0;let w={x:c.offsetX,y:c.offsetY};m.value=w,T()},pe=c=>{let w={x:c.offsetX,y:c.offsetY};m.value=w,F()},ye=()=>{h.value&&(h.value=!1,m.value=null,_())},we=()=>{h.value&&(h.value=!1,m.value=null,_())},Se=c=>{if(!u.value)return;h.value=!0;let w=u.value.getBoundingClientRect(),C={x:c.touches[0].clientX-w.x,y:c.touches[0].clientY-w.y};m.value=C,T()},ve=c=>{if(!u.value)return;let w=u.value.getBoundingClientRect(),C={x:c.touches[0].clientX-w.x,y:c.touches[0].clientY-w.y};m.value=C,F()},V=()=>{h.value&&(h.value=!1,m.value=null,_())};function se(c,w,C){const k=window.devicePixelRatio||1;c.width=w*k,c.height=C*k,c.style.width=`${w}px`,c.style.height=`${C}px`;const re=c.getContext("2d");return re.scale(k,k),re}const ke=()=>{if(!l.value||!u.value)return;let c=l.value.clientWidth;u.value.width=c,u.value.height=c,n=se(u.value,c,c);let w=0;o.length=0;for(let C=0;C<g.pointCellSize;C++)for(let k=0;k<g.pointCellSize;k++){let re=C*c/g.pointCellSize,Ze=k*c/g.pointCellSize,Ie=c/g.pointCellSize,qe=c/g.pointCellSize,Qe={id:w++,x:re+Ie/2,y:Ze+qe/2,radius:Ie*g.cellPointRadio};o.push(Qe)}B()};let De=null;return window.onresize=()=>{De&&clearTimeout(De),De=setTimeout(ke,100)},st(()=>{Ue(()=>{ke()})}),(c,w)=>(x(),G("div",{ref_key:"gestureDivRef",ref:l,style:{width:"100%",height:"100%"}},[O("canvas",{ref_key:"canvasRef",ref:u,style:{"image-rendering":"auto"},onMousedown:me,onMouseleave:we,onMousemove:pe,onMouseup:ye,onTouchend:V,onTouchmove:ve,onTouchstart:Se},null,544)],512))}}),Ht={key:0,style:{margin:"20px"}},$t={key:1,style:{margin:"20px"}},Wt={style:{display:"flex","justify-content":"space-between"}},Xt=q({__name:"VerifyMainPassword",setup(r,{expose:e}){const t=ze(),s=I(),a=J(),o=d(),i=d(),l=d(!1),u=d(null),n=d(""),h=d(JSON.parse(JSON.stringify(s.mainPasswordType))),v=d(),m=ie({mainPassword:""}),g=ie({mainPassword:[{required:!0,message:"请输入主密码",trigger:"change"}]}),T=(A,p)=>{var z;return h.value=p||s.mainPasswordType,n.value="getAndVerify",v.value=A,p===j.STANDARD&&((z=i.value)==null||z.resetFields()),m.mainPassword="",l.value=!0,new Promise(Y=>u.value=Y)},F=()=>{var A;return h.value=s.mainPasswordType,n.value="verifyAndUnlock",s.mainPasswordType===j.STANDARD&&((A=i.value)==null||A.resetFields()),m.mainPassword="",l.value=!0,new Promise(async p=>u.value=p)},_=A=>{A.validate(p=>{if(!p){o.value.focus();return}n.value==="getAndVerify"?B():n.value==="verifyAndUnlock"&&te()})},de=A=>{m.mainPassword=A,n.value==="getAndVerify"?B():n.value==="verifyAndUnlock"&&te()},B=()=>{if(!v.value){l.value=!1,u.value&&u.value(m.mainPassword);return}try{if(!v.value(m.mainPassword)){K.error("验证失败");return}}catch{K.error("验证失败");return}l.value=!1,u.value&&u.value(m.mainPassword)},te=()=>{if(!s.passwordManager.verifyPassword(m.mainPassword)){K.error("验证失败");return}if(!s.passwordManager.unlock(m.mainPassword)){K.error("验证失败");return}l.value=!1,u.value&&u.value(m.mainPassword)},fe=()=>{l.value=!1,t.push("/login")},ge=()=>{var A;h.value===j.STANDARD&&((A=o.value)==null||A.focus())},he=()=>s.serviceStatus===y.NO_LOGIN&&localStorage.getItem("showGesture")==="false"?!1:a.setting.verifyShowGesture;return e({getAndVerify:T,verifyAndUnlock:F}),(A,p)=>{const z=Ee,Y=Te,me=ut,pe=lt,ye=zt,we=ct,Se=Ne,ve=xe;return x(),Z(ve,{modelValue:f(l),"onUpdate:modelValue":p[4]||(p[4]=V=>Ke(l)?l.value=V:null),"close-on-click-modal":f(s).serviceStatus!==f(y).NO_LOGIN,"close-on-press-escape":f(s).serviceStatus!==f(y).NO_LOGIN,"show-close":f(s).serviceStatus!==f(y).NO_LOGIN,width:["xs","sm"].includes(f(ce)().value)?"95%":"400px",top:"20vh",onOpen:p[5]||(p[5]=V=>{var se;return(se=f(i))==null?void 0:se.resetFields()}),onOpened:ge},{header:b(()=>[P(z,{size:"large",style:{"user-select":"none"}},{default:b(()=>[p[8]||(p[8]=O("span",{class:"iconfont icon-verify"},null,-1)),f(s).serviceStatus===f(y).NO_LOGIN?(x(),G(Je,{key:0},[p[6]||(p[6]=R("自动登录")),p[7]||(p[7]=O("span",{style:{"font-weight":"bold"}}," · ",-1))],64)):$("",!0),p[9]||(p[9]=R(" 验证主密码 "))]),_:1})]),footer:b(()=>[O("div",Wt,[O("div",null,[f(s).serviceStatus===f(y).NO_LOGIN?(x(),Z(we,{key:0,underline:!1,type:"primary",onClick:fe},{default:b(()=>p[10]||(p[10]=[R("返回登录页 ")])),_:1})):$("",!0)]),f(h)===f(j).STANDARD?(x(),Z(Se,{key:0,type:"primary",onClick:p[3]||(p[3]=V=>_(f(i)))},{default:b(()=>p[11]||(p[11]=[R(" 确定 ")])),_:1})):$("",!0)])]),default:b(()=>[f(h)===f(j).STANDARD?(x(),G("div",Ht,[P(pe,{ref_key:"formRef",ref:i,model:f(m),rules:f(g),onSubmit:p[2]||(p[2]=rt(()=>{},["prevent"]))},{default:b(()=>[P(me,{prop:"mainPassword"},{default:b(()=>[P(Y,{ref_key:"passwordInputRef",ref:o,modelValue:f(m).mainPassword,"onUpdate:modelValue":p[0]||(p[0]=V=>f(m).mainPassword=V),autocomplete:"new-password",placeholder:"请输入主密码","show-password":"",type:"password",onKeyup:p[1]||(p[1]=at(V=>_(f(i)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):$("",!0),f(h)===f(j).GESTURE?(x(),G("div",$t,[P(ye,{"show-gesture":he(),onComplete:de},null,8,["show-gesture"])])):$("",!0)]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","width"])}}}),Yt=We(Xt,[["__scopeId","data-v-d79eec4b"]]),Zt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201400%20800'%20%3e%3crect%20x='1300'%20y='400'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%201450%20550'%20to='360%201450%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3cpath%20d='M%20100%20350%20A%20150%20150%200%201%201%20400%20350%20Q400%20370%20380%20370%20L%20250%20370%20L%20120%20370%20Q100%20370%20100%20350'%20stroke='rgb(253,%20214,%2099)'%20fill='rgb(253,%20214,%2099)'%3e%3canimateMotion%20path='M%20800%20-200%20L%20800%20-300%20L%20800%20-200'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20210%20530%20;%20-30%20210%20530%20;%200%20210%20530'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='200'%20cy='150'%20r='20'%20stroke='%231a73e8'%20fill='%231a73e8'%3e%3canimateMotion%20path='M%200%200%20L%2040%2020%20Z'%20dur='5s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3c!--%20三角形%20--%3e%3cpath%20d='M%20165%20580%20L%20270%20580%20Q275%20578%20270%20570%20L%20223%20483%20Q220%20480%20217%20483%20L%20165%20570%20Q160%20578%20165%20580'%20stroke='rgb(238,%20103,%2092)'%20fill='rgb(238,%20103,%2092)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%20210%20530'%20to='360%20210%20530'%20repeatCount='indefinite'/%3e%3c/path%3e%3ccircle%20cx='1200'%20cy='600'%20r='30'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%200%200%20L%20-20%2040%20Z'%20dur='9s'%20repeatCount='indefinite'/%3e%3c/circle%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20140%20390%20L%20180%20360%20L%20140%20390'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3crect%20x='900'%20y='600'%20rx='30'%20ry='30'%20width='90'%20height='90'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='50s'%20type='rotate'%20from='0%20900%20550'%20to='360%20900%20550'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c/svg%3e",qt="data:image/svg+xml,%3csvg%20version='1.1'%20baseProfile='full'%20width='100%25'%20height='100%25'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20800%201400'%20%3e%3c!--%20绿色大方块--%3e%3crect%20x='700'%20y='1000'%20rx='40'%20ry='40'%20width='300'%20height='300'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/rect%3e%3c!--%20白色椭圆--%3e%3cpath%20d='M%20100%20350%20A%2040%2040%200%201%201%20180%20350%20L%20180%20430%20A%2040%2040%200%201%201%20100%20430%20Z'%20stroke='rgb(241,%20243,%20244)'%20fill='rgb(241,%20243,%20244)'%3e%3canimateMotion%20path='M%20240%20590%20L%20180%20360%20L%20240%20590'%20dur='20s'%20begin='0s'%20repeatCount='indefinite'/%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20values='0%20140%20390;%20-60%20140%20390;%200%20140%20390'%20keyTimes='0%20;%200.5%20;%201'%20repeatCount='indefinite'/%3e%3c/path%3e%3c!--%20绿色小方块--%3e%3crect%20x='400'%20y='600'%20rx='40'%20ry='40'%20width='100'%20height='100'%20stroke='rgb(129,%20201,%20149)'%20fill='rgb(129,%20201,%20149)'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='35s'%20type='rotate'%20from='-30%20550%20750'%20to='330%20550%20750'%20repeatCount='indefinite'/%3e%3c/rect%3e%3csvg%20viewBox='0%200%201024%201024'%20version='1.1'%20x='100'%20y='1100'%20xmlns='http://www.w3.org/2000/svg'%20width='200px'%20height='200px'%3e%3cpath%20d='M225.28%20163.84h573.44c45.056%200%2081.92%2036.864%2081.92%2081.92v450.56c0%2045.056-36.864%2081.92-81.92%2081.92H225.28c-45.056%200-81.92-36.864-81.92-81.92V245.76c0-45.056%2036.864-81.92%2081.92-81.92z%20m430.08%20450.56c79.872%200%20143.36-63.488%20143.36-143.36s-63.488-143.36-143.36-143.36-143.36%2063.488-143.36%20143.36%2063.488%20143.36%20143.36%20143.36z%20m0-81.92c34.816%200%2061.44-26.624%2061.44-61.44s-26.624-61.44-61.44-61.44-61.44%2026.624-61.44%2061.44%2026.624%2061.44%2061.44%2061.44z'%20fill='%230af1f4'%20style='transform-box:fill-box;%20transform-origin:center;'%3e%3canimateTransform%20attributeType='XML'%20attributeName='transform'%20begin='0s'%20dur='30s'%20type='rotate'%20from='0%200%200'%20to='360%200%200'%20repeatCount='indefinite'/%3e%3c/path%3e%3c/svg%3e%3c/svg%3e",Qt={key:0,alt:"",class:"back-img hidden-xs-only",src:Zt},es={key:1,alt:"",class:"back-img hidden-sm-and-up",src:qt},ts=["element-loading-text"],ss=q({__name:"App",setup(r){const e=ee(),t=J(),s=I();let a=localStorage.getItem("topicMode")||"auto";s.setTopicMode(a),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{let u=localStorage.getItem("topicMode")||"auto";s.setTopicMode(u)});const i=d(!1);return(()=>{let u=localStorage.getItem("dynamicBackground");(!u||u==="true")&&(i.value=!0)})(),ot(()=>t.setting.dynamicBackground,u=>{localStorage.setItem("dynamicBackground",u.toString()),i.value=t.setting.dynamicBackground}),(u,n)=>{const h=it("router-view"),v=Yt,m=jt,g=Ut,T=ft,F=je;return x(),G(Je,null,[f(i)?(x(),G("img",Qt)):$("",!0),f(i)?(x(),G("img",es)):$("",!0),Ge((x(),G("div",{id:"password-app","element-loading-text":f(s).globalLoading.content,onClick:n[0]||(n[0]=_=>f(s).resetTimeoutLock())},[P(T,{locale:f(dt)},{default:b(()=>[P(h),P(v,{ref:_=>f(e).verifyPasswordRef=_},null,512),P(m,{ref:_=>f(e).fastLoginRef=_},null,512),P(g,{ref:_=>f(e).aiAddPasswordRef=_},null,512)]),_:1},8,["locale"])],8,ts)),[[F,f(s).globalLoading.vis]])],64)}}}),rs=[{path:"/",name:"Index",component:()=>oe(()=>import("./IndexPage-D8HG9zdO.js"),__vite__mapDeps([8,3,4,2,1,5,6,9,10,7,11]),import.meta.url)},{path:"/login",name:"Login",component:()=>oe(()=>import("./LoginPage-_9qS6L_m.js").then(r=>r.L),__vite__mapDeps([12,4,3,2,1,5,6,9,13]),import.meta.url)},{path:"/note",name:"Note",component:()=>oe(()=>import("./NotePage-DDs4d0XB.js"),__vite__mapDeps([14,4,3,2,1,5,6,10,15,16,7,17]),import.meta.url)}],as=[y.LOGGED,y.WAIT_INIT,y.UNLOCKED],Xe=gt({history:ht(),routes:rs});Xe.beforeEach((r,e,t)=>{if(r.path==="/login"||r.path==="/test"){le().logging=!1,t();return}let s=I();const a=J();if(as.includes(s.serviceStatus)){t();return}if(!a.setting.autoLogin||r.path.startsWith("/login")){t("/login");return}try{le().autoLogin().then(o=>{o?t():t("/login")})}catch{t("/login")}});const os=({options:r,store:e})=>{e.$resetFields=t=>{const{state:s}=r;let a=s?s():{};e.$patch(o=>{t&&(a=mt(a,t)),Object.assign(o,a)})}},Ye=pt();Ye.use(os);let _e=nt(ss);_e.use(Xe);_e.use(Ye);_e.mount("#app");export{ue as A,oe as B,Ct as C,Pt as D,At as E,Et as F,Tt as G,Ot as H,Xe as I,bs as J,Cs as K,ws as L,j as M,Me as N,kt as O,He as P,y as S,M as T,We as _,ee as a,J as b,Nt as c,ce as d,le as e,ne as f,Ft as g,E as h,W as i,zt as j,Lt as k,Ds as l,Ae as m,L as n,vt as o,Ss as p,vs as q,U as r,$e as s,Ps as t,I as u,gs as v,hs as w,ms as x,ys as y,ps as z};
