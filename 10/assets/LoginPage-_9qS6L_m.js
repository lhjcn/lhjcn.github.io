const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OSSLoginForm-B3ULRMfW.js","./element-plus-SGNFsUZO.js","./@vue-BYKpmgQC.js","./vendor-C-jb08-1.js","./ali-oss-Ci4CXxfL.js","./@element-plus-DmmXDu5M.js","./element-plus-D5Myz9W0.css","./local-DhpgDmJL.js","./index-420onEHt.js","./cos-js-sdk-v5-p1FWqW2f.js","./index-DFpWhM8J.css","./DatabaseForOSS-BfIAQqPx.js","./OSSLoginForm-Dszq2Q-0.css"])))=>i.map(i=>d[i]);
var re=Object.defineProperty;var ae=(k,n,d)=>n in k?re(k,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):k[n]=d;var z=(k,n,d)=>ae(k,typeof n!="symbol"?n+"":n,d);import{_ as h,u as $,e as M,a as G,D as ie,i as O,h as U,k as de,n as ue,m as pe,C as ge,E as ce,F as me,B as _e}from"./index-420onEHt.js";import{i as K,m as q,n as N,g as Z,h as ee,d as te,e as oe,E as I,c as H,v as fe}from"./element-plus-SGNFsUZO.js";import{c as b,o as m,D as t,v as s,B as y,d as D,a as r,C as ye,r as V,R as B,F as X,u as i,a0 as ne,z as T,t as C,T as W,x as Q,av as we}from"./@vue-BYKpmgQC.js";import{b as se,c as A,a as le,_ as ve}from"./local-DhpgDmJL.js";import{X as Y,Q as j}from"./vendor-C-jb08-1.js";const xe={},ke={class:"icp-text"};function Le(k,n){const d=K;return m(),b("div",ke,[t(d,{underline:!1,href:"https://beian.miit.gov.cn/",target:"_blank"},{default:s(()=>n[0]||(n[0]=[y("京ICP备2023032747号-2")])),_:1})])}const Se=h(xe,[["render",Le],["__scopeId","data-v-8642953e"]]),be={class:"type-line-div"},Fe={class:"type-line-item"},Ce=D({__name:"TextLine",props:{text:{type:String}},setup(k){const n=k;return(d,o)=>(m(),b("div",be,[o[0]||(o[0]=r("div",{class:"type-line"},null,-1)),r("span",Fe,ye(n.text),1),o[1]||(o[1]=r("div",{class:"type-line"},null,-1))]))}}),J=h(Ce,[["__scopeId","data-v-672ce08d"]]),Te={class:"register-guide"},Ee=D({__name:"PrivateLoginForm",setup(k){const n=Y(),d=$(),o=M(),u=G(),g=V(),e=B({serverUrl:"",username:"",password:""}),_=B({serverUrl:[{required:!0,message:"请输入服务地址",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),p=async c=>{await c.validate(async l=>{if(l){o.logging=!0;try{let L=new ie,f=await L.login(e);if(!f.status){o.logging=!1,I.error({title:"登录失败",message:f.message});return}o.loginForm=e,d.passwordManager.login(L).then(v=>{if(!v.status){o.logging=!1,I.error({title:"登录失败",message:v.message});return}let F=O(),S=JSON.parse(JSON.stringify(e));S.loginType=o.loginType;let E=U(F,JSON.stringify(S));sessionStorage.setItem("loginForm",E),u.fastLoginRef.fastLoginTip(S)}).catch(()=>{o.logging=!1})}catch{o.logging=!1}}})},w=()=>{if(n.query.type==="private"&&n.query.autoLogin){let c=u.fastLoginRef.getFastLoginForm(n.query.autoLogin);e.serverUrl=c.serverUrl||"",e.username=c.username||"",e.password=c.password||""}else e.serverUrl=(n.query.serverUrl||"")+"http://127.0.0.1:8080",e.username=(n.query.username||"")+"",e.password=(n.query.password||"")+""},a=()=>!(n.query.autoLogin&&n.query.type==="private");return w(),(c,l)=>{const L=J,f=te,v=ee,F=oe,S=Z,E=K,P=N,R=q;return m(),b(X,null,[l[7]||(l[7]=r("div",{class:"login-title"},[r("img",{alt:"",src:se}),y(" 私有服务登录 ")],-1)),t(L,{class:"input-login-line hidden-xs-only",text:"请输入登录信息"}),t(R,{class:"login-form-row"},{default:s(()=>[t(P,{sm:{span:20,offset:2},xs:{span:24}},{default:s(()=>[t(S,{ref_key:"formRef",ref:g,model:i(e),rules:i(_),"label-width":"90px"},{default:s(()=>[t(v,{label:"服务地址",prop:"serverUrl",required:""},{default:s(()=>[t(f,{modelValue:i(e).serverUrl,"onUpdate:modelValue":l[0]||(l[0]=x=>i(e).serverUrl=x),clearable:"",placeholder:"http://127.0.0.1:8080"},null,8,["modelValue"])]),_:1}),t(v,{label:"用户名",prop:"username"},{default:s(()=>[t(f,{modelValue:i(e).username,"onUpdate:modelValue":l[1]||(l[1]=x=>i(e).username=x),clearable:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),t(v,{label:"密码",prop:"password"},{default:s(()=>[t(f,{modelValue:i(e).password,"onUpdate:modelValue":l[2]||(l[2]=x=>i(e).password=x),"show-password":a(),placeholder:"密码",type:"password",onKeyup:l[3]||(l[3]=ne(x=>p(i(g)),["enter","native"]))},null,8,["modelValue","show-password"])]),_:1}),t(v,null,{default:s(()=>[t(F,{class:"login-btn",plain:"",round:"",type:"primary",onClick:l[4]||(l[4]=x=>p(i(g)))},{default:s(()=>l[5]||(l[5]=[y(" 登 录 ")])),_:1})]),_:1})]),_:1},8,["model","rules"]),r("div",Te,[t(E,{underline:!1,href:"https://github.com/peng0105/password-xl/wiki/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3%E2%80%90docker",target:"_blank",type:"primary"},{default:s(()=>l[6]||(l[6]=[y("私有部署说明文档 ")])),_:1})])]),_:1})]),_:1})],64)}}}),De=h(Ee,[["__scopeId","data-v-72e87dfa"]]);class Ie{constructor(){z(this,"fileHandle",null)}async login(n){const d={id:"password-xl-local",startIn:"documents",suggestedName:"password-xl.txt",types:[{description:"password-xl存储",accept:{"text/plain":[".txt"]}}],excludeAcceptAllOption:!0,multiple:!1};if(n.localFileType==="open"){let o=await window.showOpenFilePicker(d).catch(()=>null);if(!o)return Promise.resolve({status:!1});this.fileHandle=o[0]}else if(n.localFileType==="create"){let o=await window.showSaveFilePicker(d).catch(()=>null);if(!o)return Promise.resolve({status:!1});this.fileHandle=o}return Promise.resolve({status:!0})}async getStoreData(){return new Promise(async(n,d)=>{try{const u=await(await this.fileHandle.getFile()).text();if(!u){n("");return}let g=JSON.parse(u);n(g.storeData)}catch{d({status:!1,message:"登录失败，请检查存储文件是否正确"})}})}async getTreeNoteData(){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async setNoteData(n){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async getData(n){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async setData(n,d){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async deleteData(n){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async uploadImage(n,d){throw new Error("因为浏览器规则限制，本地存储不支持此功能，请改用其他存储方式")}async setStoreData(n){return new Promise(async d=>{let o=await this.fileHandle.createWritable();o.truncate(0);let u=await this.getSettingData(),g={info:this.getFileInfo(),storeData:n,settingData:u};o.write(JSON.stringify(g)),o.close(),d({status:!0})})}async deleteStoreData(){return this.setStoreData("")}async getSettingData(){return new Promise(async n=>{const o=await(await this.fileHandle.getFile()).text();if(!o){n("");return}let u=JSON.parse(o);n(u.settingData)})}async setSettingData(n){return new Promise(async d=>{let o=await this.fileHandle.createWritable();o.truncate(0);let u=await this.getStoreData().catch(()=>""),g={info:this.getFileInfo(),storeData:u,settingData:n};o.write(JSON.stringify(g)),o.close(),d({status:!0})})}async deleteSettingData(){return this.setSettingData("")}getFileInfo(){return"此文件为password-xl密码管理项目数据文件，password-xl官网：https://password-xl.cn，该文件最后更新时间为："+de(Date.now(),"YYYY-MM-DD HH:mm")}}const he={key:0},Pe={style:{"margin-top":"20px",padding:"10px"}},Ve={style:{"margin-top":"20px",padding:"10px"}},$e={key:1,style:{"text-align":"center",margin:"100px 0"}},Oe=D({__name:"LocalLoginForm",setup(k){const n=$(),d=j(),o=async g=>{let e=new Ie;await e.login({localFileType:g}),n.passwordManager.login(e).then(_=>{if(!_.status){I.error({title:"登录失败",message:_.message});return}let p=localStorage.getItem("mainPassword");if(p){let w=n.passwordManager.getStoreData();if(w){let a=ue(O(),p);pe(a,w.passwordData)&&n.passwordManager.unlock(a)}}d.push("/")}).catch(()=>null)},u=()=>!!window.showOpenFilePicker;return(g,e)=>{const _=J,p=H,w=N,a=q;return m(),b("div",null,[e[9]||(e[9]=r("div",{class:"login-title"},[r("img",{alt:"",src:A}),y(" 本地存储 ")],-1)),u()?(m(),b("div",he,[t(_,{class:"input-login-line",text:"请选择"}),t(a,{style:{padding:"10px"}},{default:s(()=>[t(w,{md:{span:12},sm:{span:24},class:"local-type-col"},{default:s(()=>[r("div",{class:"local-type local-create",onClick:e[0]||(e[0]=c=>o("create"))},[e[4]||(e[4]=r("div",{class:"icon-div"},[r("span",{class:"iconfont icon-create"})],-1)),t(p,{class:"local-type-text"},{default:s(()=>e[2]||(e[2]=[y(" 创建存储文件 ")])),_:1}),r("div",Pe,[t(p,{type:"info"},{default:s(()=>e[3]||(e[3]=[y("第一次使用需要先创建存储文件")])),_:1})])])]),_:1}),t(w,{md:{span:12},sm:{span:24},class:"local-type-col"},{default:s(()=>[r("div",{class:"local-type local-open",onClick:e[1]||(e[1]=c=>o("open"))},[e[7]||(e[7]=r("div",{class:"icon-div"},[r("span",{class:"iconfont icon-open-file"})],-1)),t(p,{class:"local-type-text"},{default:s(()=>e[5]||(e[5]=[y(" 打开存储文件 ")])),_:1}),r("div",Ve,[t(p,{type:"info"},{default:s(()=>e[6]||(e[6]=[y("已有存储文件，点我打开")])),_:1})])])]),_:1})]),_:1})])):(m(),b("div",$e,[t(p,{size:"large",type:"danger"},{default:s(()=>e[8]||(e[8]=[y("您的浏览器不支持本地存储，您可以在电脑版edge、chrome等浏览器使用本地存储功能 ")])),_:1})]))])}}}),qe=h(Oe,[["__scopeId","data-v-ca05cfd8"]]),Ne={class:"register-guide"},Re=D({__name:"COSLoginForm",setup(k){const n=Y(),d=$(),o=M(),u=G(),g=V(),e=B({region:"",secretId:"",secretKey:"",bucket:""}),_=B({region:[{required:!0,message:"请输入region",trigger:"blur"}],secretId:[{required:!0,message:"请输入secretId",trigger:"blur"}],secretKey:[{required:!0,message:"请输入secretKey",trigger:"blur"}],bucket:[{required:!0,message:"请输入bucket",trigger:"blur"}]}),p=async c=>{await c.validate(async l=>{if(l){o.logging=!0;try{let L=new ge,f=await L.login(e);if(!f.status){o.logging=!1,I.error({title:"登录失败",message:f.message});return}o.loginForm=e,d.passwordManager.login(L).then(v=>{if(!v.status){o.logging=!1,I.error({title:"登录失败",message:v.message});return}let F=O(),S=JSON.parse(JSON.stringify(e));S.loginType=o.loginType;let E=U(F,JSON.stringify(S));sessionStorage.setItem("loginForm",E),u.fastLoginRef.fastLoginTip(S)}).catch(()=>{o.logging=!1})}catch{o.logging=!1}}})},w=()=>{if(n.query.type==="cos"&&n.query.autoLogin){let c=u.fastLoginRef.getFastLoginForm(n.query.autoLogin);e.region=c.region||"",e.secretId=c.secretId||"",e.secretKey=c.secretKey||"",e.bucket=c.bucket||""}else e.region=(n.query.region||"")+"",e.secretId=(n.query.secretId||"")+"",e.secretKey=(n.query.secretKey||"")+"",e.bucket=(n.query.bucket||"")+""},a=()=>!(n.query.autoLogin&&n.query.type==="cos");return w(),(c,l)=>{const L=J,f=te,v=ee,F=Z,S=oe,E=K,P=N,R=q;return m(),b(X,null,[l[8]||(l[8]=r("div",{class:"login-title"},[r("img",{alt:"",src:le}),y(" 腾讯云COS登录 ")],-1)),t(L,{class:"input-login-line",text:"请输入登录信息"}),t(R,{class:"login-form-row"},{default:s(()=>[t(P,{sm:{span:20,offset:2},xs:{span:24}},{default:s(()=>[t(F,{ref_key:"formRef",ref:g,model:i(e),rules:i(_)},{default:s(()=>[t(v,{prop:"region"},{default:s(()=>[t(f,{modelValue:i(e).region,"onUpdate:modelValue":l[0]||(l[0]=x=>i(e).region=x),clearable:"",placeholder:"region"},null,8,["modelValue"])]),_:1}),t(v,{prop:"accessKeyId"},{default:s(()=>[t(f,{modelValue:i(e).secretId,"onUpdate:modelValue":l[1]||(l[1]=x=>i(e).secretId=x),clearable:"",placeholder:"secretId"},null,8,["modelValue"])]),_:1}),t(v,{prop:"accessKeySecret"},{default:s(()=>[t(f,{modelValue:i(e).secretKey,"onUpdate:modelValue":l[2]||(l[2]=x=>i(e).secretKey=x),"show-password":a(),clearable:"",placeholder:"secretKey",type:"password"},null,8,["modelValue","show-password"])]),_:1}),t(v,{prop:"bucket"},{default:s(()=>[t(f,{modelValue:i(e).bucket,"onUpdate:modelValue":l[3]||(l[3]=x=>i(e).bucket=x),clearable:"",placeholder:"bucket",onKeyup:l[4]||(l[4]=ne(x=>p(i(g)),["enter","native"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(S,{class:"login-btn",plain:"",round:"",type:"primary",onClick:l[5]||(l[5]=x=>p(i(g)))},{default:s(()=>l[6]||(l[6]=[y(" 登 录 ")])),_:1}),r("div",Ne,[t(E,{underline:!1,href:"https://github.com/peng0105/password-xl/wiki/%E8%85%BE%E8%AE%AF%E4%BA%91COS%E6%B3%A8%E5%86%8C%E6%8C%87%E5%BC%95",target:"_blank",type:"primary"},{default:s(()=>l[7]||(l[7]=[y("腾讯云COS注册指引 ")])),_:1})])]),_:1})]),_:1})],64)}}}),Ae=h(Re,[["__scopeId","data-v-aadc0d07"]]),Be=D({__name:"ElectronLoginForm",setup(k,{expose:n}){const d=$(),o=j();return n({useLocalLogin:async()=>{let g=new ce;d.passwordManager.login(g).then(e=>{if(!e.status){I.error({title:"登录失败",message:e.message});return}let _=O(),w=U(_,JSON.stringify({loginType:"electron"}));sessionStorage.setItem("loginForm",w),o.push("/")}).catch(()=>null)}}),(g,e)=>null}}),Ue=D({__name:"AndroidLoginForm",setup(k,{expose:n}){const d=$(),o=j();return n({useLocalLogin:async()=>{let g=new me;d.passwordManager.login(g).then(e=>{if(!e.status){I.error({title:"登录失败",message:e.message});return}let _=O(),w=U(_,JSON.stringify({loginType:"android"}));sessionStorage.setItem("loginForm",w),o.push("/")}).catch(()=>null)}}),(g,e)=>null}}),Ke=D({__name:"LoginType",emits:["loginTypeChange"],setup(k,{emit:n}){const d=V(),o=V(),u=n,g=()=>!!window.electronAPI,e=()=>!!window.androidAPI,_=()=>{u("loginTypeChange","electron"),d.value.useLocalLogin()},p=()=>{u("loginTypeChange","android"),o.value.useLocalLogin()};return(w,a)=>{const c=H,l=N,L=q;return m(),b("div",null,[t(L,{class:"login-type-row"},{default:s(()=>[t(l,{span:12},{default:s(()=>[r("div",{class:"login-type-item oss",onClick:a[0]||(a[0]=f=>u("loginTypeChange","oss"))},[a[6]||(a[6]=r("img",{alt:"",src:ve},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[5]||(a[5]=[y("阿里云OSS")])),_:1})])])]),_:1}),t(l,{span:12},{default:s(()=>[r("div",{class:"login-type-item cos",onClick:a[1]||(a[1]=f=>u("loginTypeChange","cos"))},[a[8]||(a[8]=r("img",{alt:"",src:le},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[7]||(a[7]=[y("腾讯云COS")])),_:1})])])]),_:1}),T("",!0),t(l,{span:12},{default:s(()=>[r("div",{class:"login-type-item private",onClick:a[3]||(a[3]=f=>u("loginTypeChange","private"))},[a[12]||(a[12]=r("img",{alt:"",src:se},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[11]||(a[11]=[y("私有服务")])),_:1})])])]),_:1}),g()?(m(),C(l,{key:1,span:12},{default:s(()=>[r("div",{class:"login-type-item local",onClick:_},[a[14]||(a[14]=r("img",{alt:"",src:A},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[13]||(a[13]=[y("本地存储")])),_:1})])])]),_:1})):e()?(m(),C(l,{key:2,span:12},{default:s(()=>[r("div",{class:"login-type-item local",onClick:p},[a[16]||(a[16]=r("img",{alt:"",src:A},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[15]||(a[15]=[y("本地存储")])),_:1})])])]),_:1})):(m(),C(l,{key:3,span:12},{default:s(()=>[r("div",{class:"login-type-item local",onClick:a[4]||(a[4]=f=>u("loginTypeChange","local"))},[a[18]||(a[18]=r("img",{alt:"",src:A},null,-1)),r("div",null,[t(c,null,{default:s(()=>a[17]||(a[17]=[y("本地存储")])),_:1})])])]),_:1}))]),_:1}),t(Be,{ref_key:"electronLoginFormRef",ref:d},null,512),t(Ue,{ref_key:"androidLoginFormRef",ref:o},null,512)])}}}),Je=h(Ke,[["__scopeId","data-v-61105346"]]),Me=""+new URL("login-CBP4XWMl.png",import.meta.url).href,He={class:"hidden-xs-only"},Xe={class:"login-card-pc"},Ye={style:{position:"sticky"}},je={key:0,class:"sliding-element"},ze=["element-loading-text"],We={style:{padding:"8px"}},Qe={class:"hidden-sm-and-up"},Ge={class:"login-form-div"},Ze={style:{display:"flex","justify-content":"center"}},et={key:0,class:"login-form-card"},tt=["element-loading-text"],ot=D({__name:"LoginPage",setup(k){const n=we(()=>_e(()=>import("./OSSLoginForm-B3ULRMfW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)),d=Y(),o=M(),u=V(1),g=_=>{o.loginType=_,!(_==="electron"||_==="android")&&(u.value=2,history.pushState(history.state,"",document.URL))};return window.addEventListener("popstate",function(){u.value===2&&(u.value=1)}),(()=>{let _=(d.query.type||"")+"";_&&g(_)})(),(_,p)=>{const w=N,a=J,c=Je,l=K,L=Ae,f=qe,v=De,F=q,S=H,E=Se,P=fe;return m(),b(X,null,[r("div",He,[t(F,null,{default:s(()=>[t(w,{lg:{span:14,offset:5},md:{span:18,offset:3},sm:{span:12,offset:6},xl:{span:10,offset:7}},{default:s(()=>[r("div",Xe,[t(F,null,{default:s(()=>[t(w,{span:12,class:"hidden-sm-and-down"},{default:s(()=>p[1]||(p[1]=[r("img",{alt:"",src:Me},null,-1)])),_:1}),t(w,{md:{span:12},sm:{span:24}},{default:s(()=>[r("div",Ye,[t(W,{name:"slide"},{default:s(()=>[i(u)===1?(m(),b("div",je,[p[2]||(p[2]=r("div",{class:"login-title"}," 欢迎使用 password-XL ",-1)),t(a,{class:"select-type-tip",text:"请选择登录方式"}),t(c,{onLoginTypeChange:g})])):Q((m(),b("div",{key:1,"element-loading-text":i(o).loggingText,class:"sliding-element"},[r("div",We,[i(u)===2?(m(),C(l,{key:0,underline:!1,type:"primary",onClick:p[0]||(p[0]=R=>u.value=1)},{default:s(()=>p[3]||(p[3]=[r("span",{class:"iconfont icon-back login-back"},null,-1),y("返回 ")])),_:1})):T("",!0)]),i(o).loginType==="oss"?(m(),C(i(n),{key:0})):T("",!0),i(o).loginType==="cos"?(m(),C(L,{key:1})):T("",!0),i(o).loginType==="local"?(m(),C(f,{key:2})):T("",!0),i(o).loginType==="private"?(m(),C(v,{key:3})):T("",!0)],8,ze)),[[P,i(o).logging]])]),_:1})])]),_:1})]),_:1})])]),_:1})]),_:1})]),r("div",Qe,[r("div",Ge,[t(F,null,{default:s(()=>[t(w,{style:{"text-align":"center"}},{default:s(()=>[t(S,{class:"login-title",style:{padding:"5px 15px"}},{default:s(()=>p[4]||(p[4]=[y(" 欢迎使用 password-XL ")])),_:1})]),_:1})]),_:1}),r("div",Ze,[t(W,{name:"slide"},{default:s(()=>[i(u)===1?(m(),b("div",et,[t(a,{style:{"margin-top":"20px","margin-bottom":"0"},text:"请选择登录方式"}),t(c,{onLoginTypeChange:g})])):Q((m(),b("div",{key:1,"element-loading-text":i(o).loggingText,class:"login-form-card"},[t(F,{style:{"margin-top":"20px"}},{default:s(()=>[t(w,{offset:1,span:22},{default:s(()=>[i(o).loginType==="oss"?(m(),C(i(n),{key:0})):T("",!0),i(o).loginType==="cos"?(m(),C(L,{key:1})):T("",!0),i(o).loginType==="local"?(m(),C(f,{key:2})):T("",!0),i(o).loginType==="private"?(m(),C(v,{key:3})):T("",!0)]),_:1})]),_:1})],8,tt)),[[P,i(o).logging]])]),_:1})])])]),t(E)],64)}}}),nt=h(ot,[["__scopeId","data-v-f3078b51"]]),ut=Object.freeze(Object.defineProperty({__proto__:null,default:nt},Symbol.toStringTag,{value:"Module"}));export{ut as L,J as _};
