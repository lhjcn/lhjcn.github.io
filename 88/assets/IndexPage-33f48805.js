import{E as Ne}from"./exceljs-6b62d6db.js";import{F as qe}from"./file-saver-38a5c18e.js";import{h as ve}from"./moment-fbc5633a.js";import{u as ie}from"./vue-i18n-3a91c5c4.js";import{E as oe,a as Be,b as pe,c as fe,d as xe,e as Ut,f as Rt,g as Se,h as tt,i as Ye,j as We,k as lt,l as Lt,m as Ce,n as At,o as at,p as Ve,q as st,r as je,s as It,t as Nt,u as ot,v as zt,w as $t,x as Gt,y as Bt,z as Yt,A as Wt,B as jt,C as Ot,D as Ht,F as Jt,G as Kt}from"./element-plus-96c47ee5.js";import{r as T,o as g,c as j,X as le,b as nt,u as e,O as z,I as E,ad as Te,J as t,a as $,S as l,P,Q as h,A as ue,R as H,ac as te,ak as rt,w as Ze,_ as dt,ar as Xt,as as qt}from"./@vue-2150b1fb.js";import{m as Zt}from"./js-md5-11f5a111.js";import{h as Me}from"./@vueuse-1138cc68.js";import{d as me,s as ae,g as he,a as Qe,l as $e,b as ze,u as Qt,c as ce,e as Pe,f as Ge,r as el,_ as it,p as ut,h as mt,i as be,j as tl}from"./index-a8ec4f2a.js";import{u as ll}from"./vue-router-67d91bd0.js";import{_ as al}from"./backImg-a3b16eec.js";import{m as sl,u as ol,n as et,o as nl,v as rl,h as dl,r as il}from"./@element-plus-82a6dcc3.js";import"./ali-oss-21f5c855.js";import"./@intlify-9ddbe450.js";import"./lodash-es-f5bdeb48.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./escape-html-cf2a8097.js";import"./normalize-wheel-es-ed76fb12.js";import"./crypto-js-d55471a7.js";import"./vuex-406a410d.js";import"./cos-js-sdk-v5-31c61e27.js";const ul={__name:"ImportExport",emits:["importComplete"],setup(q,{expose:J,emit:y}){const{t:x}=ie(),M=y,n=T(),v=T(),w=T(0),S=c=>{n.value.click(),v.value=c},V=async()=>{if(n.value.files===0)return;w.value=Date.now();const c=new Ne.Workbook;c.xlsx.load(n.value.files[0]).then(()=>{c.eachSheet(function(d){if(d.rowCount<2){oe.error(x("importExport.data.empty")),n.value.value="";return}let s=[];for(let m=2;m<=d.rowCount;m++){let a=d.getRow(m),b=o(a.getCell(1).value),D=o(a.getCell(2).value),p=o(a.getCell(3).value),C=o(a.getCell(4).value),L=o(a.getCell(5).value),R=o(a.getCell(6).value),O=o(a.getCell(7).value),W=o(a.getCell(8).value);b&&s.push({id:w.value++,name:b,address:D,userName:p,password:C,remark:R,label:u(L),insertTime:O,updateTime:W})}M("importComplete",s,v.value),n.value.value=""})}).catch(d=>{oe.error(d),n.value.value=""})},o=c=>c?typeof c=="object"?c instanceof Date?ve(c).format("YYYY-MM-DD HH:mm:ss"):c.text:c.toString():"",u=c=>{if(!c)return"";let d=[],s=c.split("、");for(let m=0;m<s.length;m++){let a=k(v.value,s[m],"");if(a)d.push(a);else{let b=[];U(v.value,s[m].split(">"),0,b);for(let D=0;D<b.length;D++)d.push(b[D])}}return Array.from(new Set(d))},k=(c,d,s)=>{for(let m=0;m<c.length;m++){let a=s?s+">"+c[m].label:c[m].label;if(d===a)return c[m].id;if(c[m].children&&c[m].children.length>0)return k(c[m].children,d,a)}},U=(c,d,s,m)=>{if(!d[s])return;for(let b=0;b<c.length;b++)if(c[b].label===d[s])return d[s+1]||m.push(c[b].id),U(c[b].children,d,s+1,m);let a={id:w.value++,label:d[s],children:[]};c.push(a),d[s+1]||m.push(a.id),U(a.children,d,s+1,m)},N=async(c,d)=>{v.value=d;const s=new Ne.Workbook,m=s.addWorksheet("sheet1");m.getCell("A1").value=x("password.name"),m.getCell("B1").value=x("password.address"),m.getCell("C1").value=x("password.userName"),m.getCell("D1").value=x("password.password"),m.getCell("E1").value=x("password.label"),m.getCell("F1").value=x("password.remark"),m.getCell("G1").value=x("password.insertTime"),m.getCell("H1").value=x("password.updateTime");for(let a=0;a<c.length;a++){let b=c[a].insertTime;b||(b=ve().format("YYYY-MM-DD HH:mm:ss")),m.getCell("A"+(a+2)).value=c[a].name,m.getCell("B"+(a+2)).value=c[a].address,m.getCell("C"+(a+2)).value=c[a].userName,m.getCell("D"+(a+2)).value=c[a].password,m.getCell("E"+(a+2)).value=Y(c[a].label),m.getCell("F"+(a+2)).value=c[a].remark,m.getCell("G"+(a+2)).value=b,m.getCell("H"+(a+2)).value=c[a].updateTime}s.xlsx.writeBuffer().then(a=>{let b=new Blob([a],{type:"application/octet-stream"});qe.saveAs(b,x("importExport.exportName")+"_"+ve().format("YYYY-MM-DD HH:mm:ss")+".xlsx")})},Y=c=>{if(!c)return"";let d=[];return G(v.value,c,d,""),d.join("、")},G=(c,d,s,m)=>{for(let a=0;a<c.length;a++){let b=m?m+">"+c[a].label:c[a].label;d.includes(c[a].id)&&s.push(b),c[a].children&&c[a].children.length>0&&G(c[a].children,d,s,b)}};return J({importExcel:S,exportExcel:N,downloadExcelTemplate:()=>{const c=new Ne.Workbook,d=c.addWorksheet("sheet1");d.getCell("A1").value=x("password.name"),d.getCell("B1").value=x("password.address"),d.getCell("C1").value=x("password.userName"),d.getCell("D1").value=x("password.password"),d.getCell("E1").value=x("password.label"),d.getCell("F1").value=x("password.remark"),d.getCell("G1").value=x("password.insertTime"),d.getCell("H1").value=x("password.updateTime"),c.xlsx.writeBuffer().then(s=>{let m=new Blob([s],{type:"application/octet-stream"});qe.saveAs(m,x("importExport.importTemplateName")+".xlsx")})}}),(c,d)=>(g(),j("input",{type:"file",onChange:V,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ref_key:"fileUploadInput",ref:n,style:{display:"none"}},null,544))}},ml=["width","height"],Oe={__name:"GesturePassword",props:{size:{type:Number,default:300},count:{type:Number,default:3},showGesture:{type:Boolean,default:!0}},emits:["complete"],setup(q,{expose:J,emit:y}){const x=Me(),M=y,n=T();let v=q;const w=le({padding:v.size*.18,background:x.value?"rgb(20,20,20)":"#fff",failColor:"#F56C6C",passColor:"#67C23A",point:{color:"#409EFF",size:v.size*.023,selected:{range:v.size*.07,color:"#409EFF",size:v.size*.023,madding:{color:"#409EFF",size:v.size*.07,lineWidth:1}}},line:{color:"#409EFF",width:2}}),S=T({}),V=T([]),o=T(!1),u=T("");let k=null;const U=()=>{w.background=x.value?"rgb(20,20,20)":"#fff",k=n.value.getContext("2d"),N()},N=()=>{k.fillStyle=w.background,k.fillRect(0,0,v.size,v.size),S.value=[];let p=(v.size-w.padding*2)/(v.count-1),C=1;for(let L=0;L<v.count;L++)for(let R=0;R<v.count;R++){let O=w.padding+R*p,W=w.padding+L*p,F=p/2,K={id:C,x:O,y:W,startX:O-F,endX:O+F,startY:W-F,endY:W+F,h:p,w:p};Y(K),S.value[C]=K,C++}},Y=p=>{let C=a(p);C&&v.showGesture&&(k.beginPath(),u.value==="fail"?k.strokeStyle=w.failColor:u.value==="pass"?k.strokeStyle=w.passColor:k.strokeStyle=w.point.selected.madding.color,k.lineWidth=w.point.selected.madding.lineWidth,k.arc(p.x,p.y,w.point.selected.madding.size,0,Math.PI*2),k.stroke()),k.beginPath(),C&&v.showGesture?(u.value==="fail"?k.fillStyle=w.failColor:u.value==="pass"?k.fillStyle=w.passColor:k.fillStyle=w.point.selected.madding.color,k.arc(p.x,p.y,w.point.selected.size,0,Math.PI*2)):(k.fillStyle=w.point.color,k.arc(p.x,p.y,w.point.size,0,Math.PI*2)),k.fill()},G=()=>{o.value=!0},_=()=>{if(!o.value)return;o.value=!1;let p=d();if(p){let C=Zt(p);M("complete",C)}N(),m()},c=p=>{u.value=p,N(),m(),p?setTimeout(()=>{u.value="",V.value=[],N()},500):(V.value=[],N())},d=()=>{let p="";for(let C=0;C<V.value.length;C++)p+=V.value[C].id+",";return p&&(p=p.substring(0,p.length-1)),p},s=p=>{let C=p.offsetX,L=p.offsetY;if(N(),m(C,L),!o.value)return;let R=b(C,L);!R||a(R)||(V.value.push(R),N(),m(C,L))},m=(p,C)=>{if(!v.showGesture)return;let L=b(p,C);if(L&&u.value===""&&(k.beginPath(),k.strokeStyle=w.point.selected.madding.color,k.lineWidth=w.point.selected.madding.lineWidth,k.arc(L.x,L.y,w.point.selected.madding.size,0,Math.PI*2),k.stroke()),V.value.length!==0){k.beginPath(),u.value==="fail"?k.strokeStyle=w.failColor:u.value==="pass"?k.strokeStyle=w.passColor:k.strokeStyle=w.line.color,k.lineWidth=w.line.width,k.lineCap="round",k.moveTo(V.value[0].x,V.value[0].y);for(let R=1;R<V.value.length;R++)k.lineTo(V.value[R].x,V.value[R].y);o.value&&p&&C&&u.value===""&&k.lineTo(p,C),k.stroke()}},a=p=>{for(let C=0;C<V.value.length;C++)if(p.id===V.value[C].id)return!0;return!1},b=(p,C)=>{for(let L in S.value){let R=S.value[L];if(p>R.startX+w.point.selected.range&&p<R.endX-w.point.selected.range&&C>R.startY+w.point.selected.range&&C<R.endY-w.point.selected.range)return R}},D=p=>{let C=p.touches[0].clientX-n.value.offsetLeft,L=p.touches[0].clientY-n.value.offsetTop;s({offsetX:C,offsetY:L})};return nt(()=>{U()}),J({setVerifyStatus:c}),(p,C)=>e(v).size?(g(),j("canvas",{key:0,width:e(v).size,height:e(v).size,ref_key:"canvasRef",ref:n,onMousedown:G,onMouseup:_,onMousemove:C[0]||(C[0]=L=>s(L)),onMouseleave:_,onTouchstart:G,onTouchend:_,onTouchmove:D},null,40,ml)):z("",!0)}},cl={style:{"text-align":"center"}},pl={class:"dialog-footer"},fl={__name:"DeleteAccount",emits:["deleteAccount"],setup(q,{expose:J,emit:y}){const{t:x}=ie(),M=y,n=T(),v=le({deleteAccount:!1}),w=T(""),S=T(""),V=()=>{let U=me(S.value,ae.state.verifyCode);if(U&&U==="password-x"){w.value==="gesture"&&n.value.setVerifyStatus("pass");let N=localStorage.getItem("databaseForm"),Y=me(he(),N);if(JSON.parse(Y).keyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){oe.error("演示账号不能注销");return}Qe("password.json"),Qe("labelTree.json"),localStorage.removeItem("systemConfig"),oe.success(x("systemSetting.deleteAccount.success")),M("deleteAccount")}else w.value==="common"?oe.error(x("systemSetting.deleteAccount.mainPasswordError")):n.value.setVerifyStatus("fail")},o=()=>{w.value=ae.state.mainPasswordType,v.deleteAccount=!0},u=U=>{S.value=U,V()},k=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){k.value=document.documentElement.clientWidth<728}),J({showDeleteAccount:o}),(U,N)=>{const Y=Be,G=Oe,_=pe,c=fe,d=xe;return g(),E(d,{fullscreen:e(k),modelValue:e(v).deleteAccount,"onUpdate:modelValue":N[1]||(N[1]=s=>e(v).deleteAccount=s),title:e(x)("systemSetting.deleteAccount"),width:"400px"},Te({default:t(()=>[l(Y,{type:"error",closable:!1},{default:t(()=>[P(h(e(x)("systemSetting.deleteAccount.text")),1)]),_:1}),$("div",cl,[e(w)==="gesture"?(g(),E(G,{key:0,ref_key:"gesturePasswordRef",ref:n,onComplete:u},null,512)):z("",!0),e(w)==="common"?(g(),E(_,{key:1,modelValue:e(S),"onUpdate:modelValue":N[0]||(N[0]=s=>ue(S)?S.value=s:null),style:{"margin-top":"20px"}},null,8,["modelValue"])):z("",!0)])]),_:2},[e(w)==="common"?{name:"footer",fn:t(()=>[$("span",pl,[l(c,{type:"danger",onClick:V},{default:t(()=>[P(h(e(x)("systemSetting.deleteAccount.affirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},wl={style:{"text-align":"center"}},gl={class:"dialog-footer"},bl={__name:"SystemSetting",emits:["updateMainPassword","deleteAccount","systemChangeChange"],setup(q,{expose:J,emit:y}){const x=ll(),M=Me(),{t:n,locale:v}=ie(),w=y,S=T(),V=le({setting:!1}),o=le($e()),u=le({languages:[],sorts:[],topics:[],cacheMains:[],showAddTimes:[],showUpTimes:[],showLabels:[],enableLabels:[],verifyShowGestures:[],cacheDatabaseForms:[],autoGeneratePasswords:[],showPasswordStrengths:[]}),k=()=>{u.languages=[{key:"zh-cn",label:"简体中文"},{key:"en-us",label:"English"}],u.sorts=[{key:"insertTimeDesc",label:n("systemSetting.sort.insertTimeDesc")},{key:"insertTimeAsc",label:n("systemSetting.sort.insertTimeAsc")},{key:"updateTimeDesc",label:n("systemSetting.sort.updateTimeDesc")},{key:"updateTimeAsc",label:n("systemSetting.sort.updateTimeAsc")},{key:"nameAsc",label:n("systemSetting.sort.nameAsc")},{key:"nameDesc",label:n("systemSetting.sort.nameDesc")},{key:"strengthDesc",label:n("systemSetting.sort.strengthAsc")},{key:"strengthAsc",label:n("systemSetting.sort.strengthDesc")}],u.topics=[{key:!1,label:n("systemSetting.topic.light")},{key:!0,label:n("systemSetting.topic.dark")}],u.cacheMains=[{key:!0,label:n("systemSetting.cacheMainPassword.enable")},{key:!1,label:n("systemSetting.cacheMainPassword.disabled")}],u.showAddTimes=[{key:!0,label:n("systemSetting.showAddTime.enable")},{key:!1,label:n("systemSetting.showAddTime.disabled")}],u.showUpTimes=[{key:!0,label:n("systemSetting.showUpTime.enable")},{key:!1,label:n("systemSetting.showUpTime.disabled")}],u.showLabels=[{key:!0,label:n("systemSetting.showLabel.enable")},{key:!1,label:n("systemSetting.showLabel.disabled")}],u.enableLabels=[{key:!0,label:n("systemSetting.enableLabel.enable")},{key:!1,label:n("systemSetting.enableLabel.disabled")}],u.verifyShowGestures=[{key:!0,label:n("mainPasswordSetting.verify.showGesture.enable")},{key:!1,label:n("mainPasswordSetting.verify.showGesture.disabled")}],u.cacheDatabaseForms=[{key:!0,label:n("systemSetting.cacheDatabaseForm.enable")},{key:!1,label:n("systemSetting.cacheDatabaseForm.disabled")}],u.autoGeneratePasswords=[{key:!0,label:n("passwordForm.autoGeneratePassword.enable")},{key:!1,label:n("passwordForm.autoGeneratePassword.disabled")}],u.showPasswordStrengths=[{key:!0,label:n("systemSetting.showPasswordStrength.enable")},{key:!1,label:n("systemSetting.showPasswordStrength.disabled")}]};let U=null;const N=()=>{k();let m=$e();for(let a in m)o[a]=m[a];U=JSON.stringify(o),V.setting=!0},Y=()=>{V.setting=!1},G=()=>{let m=o.defaultPasswordRule;if(!m.number&&!m.symbol&&!m.lowercase&&!m.uppercase){oe.error(n("systemSetting.passwordRuleVerify"));return}Qt(o);let a=JSON.parse(U);o.cacheMainPassword!==a.cacheMainPassword&&o.cacheMainPassword===!1&&(localStorage.removeItem("mainPasswordCiphertext"),console.log("删除主密码缓存")),o.cacheDatabaseForm!==a.cacheDatabaseForm&&o.cacheDatabaseForm===!1&&(localStorage.removeItem("databaseForm"),console.log("删除自动登录信息")),o.language!==v.value&&(v.value=o.language,console.log("系统语言设置为：",o.language)),M.value!==o.darkMode&&(M.value=o.darkMode,console.log("暗黑模式设置为：",o.darkMode)),o.sortRule!==a.sortRule&&(w("systemChangeChange","sortChange",o.sortRule),console.log("排序规则设置为：",o.sortRule)),o.showPasswordStrength!==a.showPasswordStrength&&(w("systemChangeChange","showPasswordStrength",o.showPasswordStrength),console.log("是否显示密码强度设置为：",o.showPasswordStrength)),V.setting=!1},_=()=>{localStorage.removeItem("databaseForm"),localStorage.removeItem("mainPasswordCiphertext"),ae.commit("delDatabase"),ae.commit("delDatabaseForm"),ae.commit("delVerifyCode"),x.push("/login")},c=()=>{V.setting=!1,w("updateMainPassword")},d=()=>{V.setting=!1,S.value.showDeleteAccount()},s=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){s.value=document.documentElement.clientWidth<728}),J({logout:_,openSystemSetting:N,showUpdateMainPassword:c,settingForm:o}),(m,a)=>{const b=Ut,D=Rt,p=Se,C=tt,L=Ye,R=pe,O=We,W=lt,F=fe,K=Lt,Ee=Ce,Fe=At,De=at,Ue=Ve,Re=Be,_e=xe,ye=fl;return g(),j(H,null,[l(_e,{fullscreen:e(s),modelValue:e(V).setting,"onUpdate:modelValue":a[17]||(a[17]=i=>e(V).setting=i),title:e(n)("systemSetting.title"),width:"600px"},{footer:t(()=>[$("span",gl,[l(F,{plain:"",onClick:Y},{default:t(()=>[P(h(e(n)("systemSetting.close")),1)]),_:1}),l(F,{type:"primary",plain:"",onClick:G},{default:t(()=>[P(h(e(n)("systemSetting.save")),1)]),_:1})])]),default:t(()=>[l(Ue,{"label-width":"150px"},{default:t(()=>[l(De,{"tab-position":"left",style:{height:"350px"}},{default:t(()=>[l(W,{label:e(n)("systemSetting.type.general")},{default:t(()=>[l(p,{label:e(n)("systemSetting.language")},{default:t(()=>[l(D,{modelValue:e(o).language,"onUpdate:modelValue":a[0]||(a[0]=i=>e(o).language=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).languages,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.sort")},{default:t(()=>[l(D,{modelValue:e(o).sortRule,"onUpdate:modelValue":a[1]||(a[1]=i=>e(o).sortRule=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).sorts,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("passwordForm.autoGeneratePassword")},{default:t(()=>[l(D,{modelValue:e(o).autoGeneratePassword,"onUpdate:modelValue":a[2]||(a[2]=i=>e(o).autoGeneratePassword=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).autoGeneratePasswords,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.defaultPasswordRule")},{default:t(()=>[l(O,{style:{"margin-top":"15px"}},{default:t(()=>[l(L,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.uppercase,"onUpdate:modelValue":a[3]||(a[3]=i=>e(o).defaultPasswordRule.uppercase=i),label:e(n)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(L,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.lowercase,"onUpdate:modelValue":a[4]||(a[4]=i=>e(o).defaultPasswordRule.lowercase=i),label:e(n)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(L,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.number,"onUpdate:modelValue":a[5]||(a[5]=i=>e(o).defaultPasswordRule.number=i),label:e(n)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(L,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.symbol,"onUpdate:modelValue":a[6]||(a[6]=i=>e(o).defaultPasswordRule.symbol=i),label:e(n)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1}),l(L,{span:16},{default:t(()=>[$("div",null,[l(R,{size:"small",style:{position:"relative",top:"3px"},modelValue:e(o).defaultPasswordRule.length,"onUpdate:modelValue":a[7]||(a[7]=i=>e(o).defaultPasswordRule.length=i)},{prepend:t(()=>[P(h(e(n)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["label"]),l(W,{label:e(n)("systemSetting.type.personalization")},{default:t(()=>[l(p,{label:e(n)("systemSetting.topic")},{default:t(()=>[l(D,{modelValue:e(o).darkMode,"onUpdate:modelValue":a[8]||(a[8]=i=>e(o).darkMode=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).topics,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showPasswordStrength")},{default:t(()=>[l(D,{modelValue:e(o).showPasswordStrength,"onUpdate:modelValue":a[9]||(a[9]=i=>e(o).showPasswordStrength=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).showPasswordStrengths,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showAddTime")},{default:t(()=>[l(D,{modelValue:e(o).showAddTime,"onUpdate:modelValue":a[10]||(a[10]=i=>e(o).showAddTime=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).showAddTimes,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showUpTime")},{default:t(()=>[l(D,{modelValue:e(o).showUpTime,"onUpdate:modelValue":a[11]||(a[11]=i=>e(o).showUpTime=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).showUpTimes,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.enableLabel")},{default:t(()=>[l(D,{modelValue:e(o).enableLabel,"onUpdate:modelValue":a[12]||(a[12]=i=>e(o).enableLabel=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).enableLabels,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showLabel")},{default:t(()=>[l(D,{disabled:!e(o).enableLabel,modelValue:e(o).showLabel,"onUpdate:modelValue":a[13]||(a[13]=i=>e(o).showLabel=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).showLabels,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(W,{label:e(n)("systemSetting.type.security")},{default:t(()=>[l(p,{label:e(n)("systemSetting.cacheMainPassword")},{default:t(()=>[l(D,{modelValue:e(o).cacheMainPassword,"onUpdate:modelValue":a[14]||(a[14]=i=>e(o).cacheMainPassword=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).cacheMains,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.cacheDatabaseForm")},{default:t(()=>[l(D,{modelValue:e(o).cacheDatabaseForm,"onUpdate:modelValue":a[15]||(a[15]=i=>e(o).cacheDatabaseForm=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).cacheDatabaseForms,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("mainPasswordSetting.verify.showGesture")},{default:t(()=>[l(D,{modelValue:e(o).verifyShowGesture,"onUpdate:modelValue":a[16]||(a[16]=i=>e(o).verifyShowGesture=i)},{default:t(()=>[(g(!0),j(H,null,te(e(u).verifyShowGestures,i=>(g(),E(b,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(W,{label:e(n)("systemSetting.type.other")},{default:t(()=>[$("div",wl,[l(F,{plain:"",onClick:c},{default:t(()=>[P(h(e(n)("systemSetting.updateMainPassword")),1)]),_:1}),l(F,{plain:"",type:"danger",onClick:d},{default:t(()=>[P(h(e(n)("systemSetting.deleteAccount")),1)]),_:1}),l(F,{type:"warning",plain:"",onClick:_},{default:t(()=>[P(h(e(n)("systemSetting.logout")),1)]),_:1})])]),_:1},8,["label"]),l(W,{label:e(n)("systemSetting.about"),style:{"text-align":"center"}},{default:t(()=>[l(Fe,{column:1,style:{margin:"15px"}},{default:t(()=>[l(K,null,{label:t(()=>[P(h(e(n)("systemSetting.about.version"))+": ",1)]),default:t(()=>[P(" "+h(e(ze)("VITE_VERSION")),1)]),_:1}),l(K,null,{label:t(()=>[P(h(e(n)("systemSetting.about.openSourceUrl"))+": ",1)]),default:t(()=>[l(Ee,{target:"_blank",href:e(ze)("VITE_OPEN_SOURCE_URL")},{default:t(()=>[P(h(e(ze)("VITE_OPEN_SOURCE_URL")),1)]),_:1},8,["href"])]),_:1}),l(K,null,{default:t(()=>[P(h(e(n)("systemSetting.about.submit")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),_:1}),l(Re,{style:{"margin-top":"20px"},type:"warning"},{default:t(()=>[P(h(e(n)("systemSetting.takeEffect")),1)]),_:1})]),_:1},8,["fullscreen","modelValue","title"]),l(ye,{ref_key:"deleteAccountRef",ref:S,onDeleteAccount:_},null,512)],64)}}},_l={style:{"text-align":"center"}},yl={class:"dialog-footer"},ct={__name:"MainPasswordVerify",emits:["verifyPass"],setup(q,{expose:J,emit:y}){const{t:x}=ie(),M=y,n=T(),v=T(""),w=T(""),S=le({verifyMainPassword:!1}),V=_=>{v.value=_,o()},o=()=>{let _=me(v.value,ae.state.verifyCode);_&&_==="password-x"?(w.value==="gesture"&&n.value.setVerifyStatus("pass"),M("verifyPass",v.value),k(v.value),v.value="",S.verifyMainPassword=!1):w.value==="common"?oe.error(x("mainPasswordVerify.form.verify")):n.value.setVerifyStatus("fail")},u=()=>{localStorage.removeItem("mainPasswordCiphertext")},k=_=>{if(ce("cacheMainPassword")===!1)return;let d=he(),s=Pe(d,_);localStorage.setItem("mainPasswordCiphertext",s)},U=()=>{if(ce("cacheMainPassword")===!1)return null;let c=localStorage.getItem("mainPasswordCiphertext");if(!c)return null;let d=he(),s=me(d,c);return s||null},N=()=>ce("verifyShowGesture")!==!1,Y=(_=!0)=>{if(w.value=ae.state.mainPasswordType,!_){S.verifyMainPassword=!0;return}let c=U();if(!c){S.verifyMainPassword=!0;return}let d=me(c,ae.state.verifyCode);d&&d==="password-x"?M("verifyPass",c):S.verifyMainPassword=!0},G=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){G.value=document.documentElement.clientWidth<728}),J({verifyMainPassword:Y,delLocalMainPassword:u}),(_,c)=>{const d=Oe,s=pe,m=Se,a=Ve,b=fe,D=xe;return g(),E(D,{fullscreen:e(G),modelValue:e(S).verifyMainPassword,"onUpdate:modelValue":c[1]||(c[1]=p=>e(S).verifyMainPassword=p),title:e(x)("mainPasswordVerify.form.title"),width:"400px"},Te({default:t(()=>[$("div",_l,[e(w)==="gesture"&&e(S).verifyMainPassword?(g(),E(d,{key:0,"show-gesture":N(),ref_key:"gesturePasswordRef",ref:n,onComplete:V},null,8,["show-gesture"])):z("",!0),e(w)==="common"&&e(S).verifyMainPassword?(g(),E(a,{key:1,style:{padding:"10px"}},{default:t(()=>[l(m,null,{default:t(()=>[l(s,{modelValue:e(v),"onUpdate:modelValue":c[0]||(c[0]=p=>ue(v)?v.value=p:null),placeholder:e(x)("mainPasswordVerify.form.mainPassword"),type:"password",onKeyup:rt(o,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1})]),_:1})):z("",!0)])]),_:2},[e(w)==="common"?{name:"footer",fn:t(()=>[$("span",yl,[l(b,{type:"primary",disabled:!e(v),onClick:o},{default:t(()=>[P(h(e(x)("mainPasswordVerify.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},vl={class:"dialog-footer"},hl={__name:"MainPasswordSetting",emits:["mainPasswordChange"],setup(q,{expose:J,emit:y}){const{t:x}=ie(),M=y,n=T(),v=T(),w=T("gesture"),S=T(""),V=T(""),o=le({mainPassword:!1}),u=T(""),k=c=>{u.value==="setting"?(S.value=c,u.value="affirm",v.value.setVerifyStatus("")):u.value==="affirm"&&(V.value=c,U())},U=()=>{if(S.value!==V.value){oe.error(x("mainPasswordSetting.form.passwordsDiff"));return}let c=localStorage.getItem("databaseForm"),d=me(he(),c);if(JSON.parse(d).accessKeyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){oe.error("演示账号不能修改主密码");return}w.value==="gesture"?ae.commit("setMainPasswordType","gesture"):ae.commit("setMainPasswordType","common"),M("mainPasswordChange",S.value,w.value);let m=ce("cacheMainPassword");if(m||m==null){let a=he(),b=Pe(a,S.value);localStorage.setItem("mainPasswordCiphertext",b)}S.value="",V.value="",o.mainPassword=!1},N=()=>{u.value="setting",o.mainPassword=!0},Y=()=>{n.value.verifyMainPassword(!1)},G=()=>{w.value==="gesture"&&(u.value="setting"),S.value="",V.value=""},_=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){_.value=document.documentElement.clientWidth<728}),J({settingMainPassword:N,updateMainPassword:Y}),(c,d)=>{const s=Be,m=st,a=Oe,b=Ce,D=lt,p=pe,C=Se,L=Ve,R=at,O=fe,W=xe,F=ct;return g(),j(H,null,[l(W,{fullscreen:e(_),modelValue:e(o).mainPassword,"onUpdate:modelValue":d[4]||(d[4]=K=>e(o).mainPassword=K),title:e(x)("mainPasswordSetting.form.setMainPassword"),width:"470px"},Te({default:t(()=>[l(s,{type:"error",style:{position:"relative",top:"-10px"},closable:!1},{default:t(()=>[P(h(e(x)("mainPasswordSetting.forget.message")),1)]),_:1}),l(R,{modelValue:e(w),"onUpdate:modelValue":d[3]||(d[3]=K=>ue(w)?w.value=K:null),style:{"margin-top":"10px"},type:"card",onTabChange:G},{default:t(()=>[l(D,{label:e(x)("mainPasswordSetting.passwordType.gesture"),name:"gesture",style:{"text-align":"center"}},{default:t(()=>[$("div",null,[e(u)==="setting"?(g(),E(m,{key:0},{default:t(()=>[P(h(e(x)("mainPasswordSetting.gesture.first")),1)]),_:1})):z("",!0),e(u)==="affirm"?(g(),E(m,{key:1},{default:t(()=>[P(h(e(x)("mainPasswordSetting.gesture.affirm")),1)]),_:1})):z("",!0)]),e(o).mainPassword&&e(w)==="gesture"?(g(),E(a,{key:0,ref_key:"gesturePasswordRef",ref:v,onComplete:k},null,512)):z("",!0),$("div",null,[l(b,{underline:!1,style:{position:"relative",top:"-2px"},type:"primary",onClick:d[0]||(d[0]=K=>u.value="setting")},{default:t(()=>[P(h(e(x)("mainPasswordSetting.gesture.reset")),1)]),_:1})])]),_:1},8,["label"]),l(D,{label:e(x)("mainPasswordSetting.passwordType.common"),name:"common",style:{"text-align":"center"}},{default:t(()=>[l(L,{inline:!0,"label-width":"100px",style:{"margin-top":"20px"}},{default:t(()=>[l(C,{label:e(x)("mainPasswordSetting.form.newMainPassword")},{default:t(()=>[l(p,{type:"password",modelValue:e(S),"onUpdate:modelValue":d[1]||(d[1]=K=>ue(S)?S.value=K:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"]),l(C,{label:e(x)("mainPasswordSetting.form.newMainPasswordAffirm")},{default:t(()=>[l(p,{type:"password",modelValue:e(V),"onUpdate:modelValue":d[2]||(d[2]=K=>ue(V)?V.value=K:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:2},[e(w)==="common"?{name:"footer",fn:t(()=>[$("span",vl,[l(O,{type:"primary",disabled:!e(S),onClick:U},{default:t(()=>[P(h(e(x)("mainPasswordSetting.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"]),l(F,{ref_key:"mainPasswordVerifyRef",ref:n,onVerifyPass:N},null,512)],64)}}},kl={class:"dialog-footer"},Pl={__name:"PasswordForm",props:{labelTree:Array},emits:["addPassword","updatePassword"],setup(q,{expose:J,emit:y}){const x=y,{t:M}=ie(),n=T(),v=le({password:!1}),w=T(""),S=le({uppercase:"ABCDEFGHJKLMNPQRSTUVWXYZ",lowercase:"abcdefghjkmnpqrstuvwxyz",number:"0123456789",symbol:"~!@#$^&*()_+.,;"}),V=()=>({id:0,name:"",address:"",userName:"",password:"",remark:"",label:"",insertTime:"",updateTime:""}),o=le(V()),u=le({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!0}),k=le({name:[{required:!0,message:M("passwordForm.form.name.verify"),trigger:"blur"}]}),U=()=>{if(!u.number&&!u.symbol&&!u.lowercase&&!u.uppercase){oe.error(M("systemSetting.passwordRuleVerify"));return}let d=[];u.lowercase&&d.push(S.lowercase),u.uppercase&&d.push(S.uppercase),u.symbol&&d.push(S.symbol),u.number&&d.push(S.number),o.password=el(d,u.length)},N=async d=>{await d.validate(s=>{s&&(v.password=!1,w.value==="add"?(o.id=Date.now(),o.insertTime=ve().format("YYYY-MM-DD HH:mm:ss"),x("addPassword",JSON.parse(JSON.stringify(o)))):(o.updateTime=ve().format("YYYY-MM-DD HH:mm:ss"),x("updatePassword",JSON.parse(JSON.stringify(o)))))})},Y=()=>{let d=ce("defaultPasswordRule");if(d)for(let s in d)u[s]=d[s]},G=()=>{Y();let d=V();for(let m in d)o[m]=d[m];ce("autoGeneratePassword")&&U(),w.value="add",v.password=!0},_=d=>{Y();for(let s in o)o[s]=d[s];w.value="update",v.password=!0},c=()=>document.documentElement.clientWidth;return J({showAddPassword:G,showUpdatePassword:_}),(d,s)=>{const m=pe,a=Se,b=fe,D=Ye,p=We,C=tt,L=je,R=It,O=Ve,W=Nt;return g(),E(W,{modelValue:e(v).password,"onUpdate:modelValue":s[13]||(s[13]=F=>e(v).password=F),title:e(w)==="add"?e(M)("passwordForm.form.addPassword"):e(M)("passwordForm.form.editPassword"),size:"620px",direction:c()>768?"rtl":"btt"},{footer:t(()=>[$("span",kl,[l(b,{onClick:s[12]||(s[12]=F=>N(e(n))),type:"primary"},{default:t(()=>[P(h(e(M)("passwordForm.generateForm.save")),1)]),_:1})])]),default:t(()=>[l(O,{ref_key:"passwordFormRef",ref:n,model:e(o),rules:e(k),"label-width":"70px",style:{"padding-right":"30px"}},{default:t(()=>[l(a,{label:e(M)("password.name"),prop:"name"},{default:t(()=>[l(m,{modelValue:e(o).name,"onUpdate:modelValue":s[0]||(s[0]=F=>e(o).name=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.address")},{default:t(()=>[l(m,{modelValue:e(o).address,"onUpdate:modelValue":s[1]||(s[1]=F=>e(o).address=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.userName")},{default:t(()=>[l(m,{modelValue:e(o).userName,"onUpdate:modelValue":s[2]||(s[2]=F=>e(o).userName=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.password")},{default:t(()=>[l(L,{style:{width:"100%"}},{default:t(()=>[l(p,null,{default:t(()=>[l(D,null,{default:t(()=>[l(m,{modelValue:e(o).password,"onUpdate:modelValue":s[4]||(s[4]=F=>e(o).password=F),clearable:""},{append:t(()=>[l(b,{onClick:s[3]||(s[3]=F=>e(Ge)(e(o).password))},{default:t(()=>[P(h(e(M)("passwordForm.generateForm.password.copy")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(u).uppercase,"onUpdate:modelValue":s[5]||(s[5]=F=>e(u).uppercase=F),label:e(M)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(u).lowercase,"onUpdate:modelValue":s[6]||(s[6]=F=>e(u).lowercase=F),label:e(M)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(u).number,"onUpdate:modelValue":s[7]||(s[7]=F=>e(u).number=F),label:e(M)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(u).symbol,"onUpdate:modelValue":s[8]||(s[8]=F=>e(u).symbol=F),label:e(M)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(D,{style:{"text-align":"center"}},{default:t(()=>[l(m,{modelValue:e(u).length,"onUpdate:modelValue":s[9]||(s[9]=F=>e(u).length=F),size:"small",style:{width:"120px"}},{prepend:t(()=>[P(h(e(M)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"]),l(b,{plain:"",size:"small",style:{position:"relative",top:"-5px","margin-left":"10px"},type:"success",onClick:U},{default:t(()=>[P(h(e(M)("passwordForm.generateForm.randomPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),e(ce)("enableLabel")!==!1?(g(),E(a,{key:0,label:e(M)("password.label")},{default:t(()=>[l(R,{modelValue:e(o).label,"onUpdate:modelValue":s[10]||(s[10]=F=>e(o).label=F),"value-key":"id",data:q.labelTree,"check-strictly":"",multiple:"","default-expand-all":"",placeholder:e(M)("password.label.placeholder"),filterable:""},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])):z("",!0),l(a,{label:e(M)("password.remark")},{default:t(()=>[l(m,{type:"textarea",placeholder:e(M)("passwordForm.generateForm.remark"),rows:4,modelValue:e(o).remark,"onUpdate:modelValue":s[11]||(s[11]=F=>e(o).remark=F)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","direction"])}}};const xl={class:"label-tree-node"},Sl=["onClick","onBlur"],Cl={class:"label-tree-node-menu"},Vl={__name:"LabelTree",emits:["labelCheckChange","labelTreeChange"],setup(q,{expose:J,emit:y}){const x=Me(),{t:M}=ie(),n=y,v=T(),w=T([]),S=T([]),V=T(!1),o=()=>{let s=v.value.getCheckedNodes();n("labelCheckChange",s)},u=(s,m)=>s?m.label.includes(s):!0,k=s=>{const m={id:Date.now(),label:M("labelTree.addLabel"),children:[]};s.children||(s.children=[]),s.children.push(m)},U=(s,m)=>{const a=s.parent,b=a.data.children||a.data,D=b.findIndex(p=>p.id===m.id);b.splice(D,1)},N=s=>!s.edit,Y=()=>{S.value.push({id:Date.now(),label:M("labelTree.firstAddLabel"),children:[]})},G=()=>{V.value&&ut("labelTree.json",{labelTree:S.value})},_=s=>{S.value=s};Ze(w,s=>{v.value.filter(s)}),Ze(S,()=>{G(),n("labelTreeChange",S.value)},{deep:!0});const c=()=>{mt("labelTree.json").then(s=>{s&&s.labelTree?S.value=s.labelTree:S.value=[],V.value=!0}).catch(s=>{ot.error(s.code)})},d=()=>x.value;return c(),J({setLabelTree:_}),(s,m)=>{const a=pe,b=fe,D=Ce,p=zt,C=$t,L=je;return g(),E(L,{class:"body-card",style:dt({"background-color":d()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[P(h(e(M)("labelTree.title")),1)]),default:t(()=>[l(a,{modelValue:e(w),"onUpdate:modelValue":m[0]||(m[0]=R=>ue(w)?w.value=R:null),clearable:"",placeholder:e(M)("labelTree.search.placeholder")},null,8,["modelValue","placeholder"]),l(C,{height:"50vh"},{default:t(()=>[l(p,{data:e(S),"show-checkbox":"",ref_key:"labelTreeRef",ref:v,draggable:"","node-key":"id",style:{"margin-top":"10px","background-color":"rgba(0,0,0,0)"},onCheck:o,"filter-node-method":u,"expand-on-click-node":!1,"allow-drag":N,"default-expand-all":""},{empty:t(()=>[l(b,{size:"small",type:"primary",plain:"",onClick:Y},{default:t(()=>[P(h(e(M)("labelTree.firstAddLabel")),1)]),_:1})]),default:t(({node:R,data:O})=>[$("span",xl,[R.edit?z("",!0):(g(),j("span",{key:0,onClick:W=>R.edit=!0,onBlur:W=>R.edit=!1},h(O.label),41,Sl)),R.edit?(g(),E(a,{key:1,style:{width:"60%"},ref:R.id+"_input",size:"small",onBlur:W=>R.edit=!1,modelValue:O.label,"onUpdate:modelValue":W=>O.label=W},null,8,["onBlur","modelValue","onUpdate:modelValue"])):z("",!0),$("span",Cl,[l(D,{onClick:W=>k(O),type:"primary",underline:!1},{default:t(()=>[P(h(e(M)("labelTree.tree.add")),1)]),_:2},1032,["onClick"]),l(D,{onClick:W=>U(R,O),type:"danger",underline:!1,style:{"margin-left":"8px"}},{default:t(()=>[P(h(e(M)("labelTree.tree.remove")),1)]),_:2},1032,["onClick"])])])]),_:1},8,["data"])]),_:1})]),_:1},8,["style"])}}},Tl=it(Vl,[["__scopeId","data-v-5b83f236"]]);const ke=q=>(Xt("data-v-6ce3fc80"),q=q(),qt(),q),Ml=ke(()=>$("img",{alt:"",class:"back-img",src:al},null,-1)),El={style:{display:"flex","justify-content":"space-between"}},Fl={class:"hidden-xs-only"},Dl=ke(()=>$("br",null,null,-1)),Ul={key:1},Rl={style:{display:"flex","justify-content":"end"},class:"password-title-right"},Ll=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#67C23A"}},null,-1)),Al=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#E6A23C"}},null,-1)),Il=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#F56C6C"}},null,-1)),Nl={key:0},zl={class:"password-text"},$l={class:"pass-action-div"},Gl={__name:"IndexPage",setup(q){const J=Me(),{t:y,locale:x}=ie(),M=T(),n=T(),v=T(),w=T(),S=T(),V=T(),o=T(),u=le({}),k=T(""),U=T(""),N=T(""),Y=T(!1),G=T(""),_=T([]),c=T([]),d=T([]),s=T([]);let m=null;const a=()=>{m!=null&&clearTimeout(m),m=setTimeout(function(){b()},200)},b=async()=>{if(!k.value&&!d.value){c.value=_.value;return}let r=[];for(let f=0;f<_.value.length;f++){let A=(_.value[f].name||"").toUpperCase(),B=(_.value[f].userName||"").toUpperCase(),X=(_.value[f].address||"").toUpperCase(),Z=(_.value[f].remark||"").toUpperCase(),Q=(_.value[f].password||"").toUpperCase(),se=!1;if(!k.value)se=!0;else{let ne=k.value.toLowerCase(),ee=(A||"").toLowerCase().includes(ne),ge=(B||"").toLowerCase().includes(ne),Le=(X||"").toLowerCase().includes(ne),Ae=(Z||"").toLowerCase().includes(ne),Ie=(Q||"").toLowerCase().includes(ne);(ee||ge||Le||Ae||Ie)&&(se=!0)}let re=!1;if(d.value.length===0)re=!0;else for(let ne=0;ne<d.value.length;ne++){let ee=d.value[ne];if(_.value[f].label&&_.value[f].label.includes(ee.id)){re=!0;break}}se&&re&&r.push(_.value[f])}c.value=r},D=()=>{M.value.showAddPassword()},p=r=>{M.value.showUpdatePassword(r)},C=r=>{_.value.unshift(r),we(),b()},L=r=>{for(let f=0;f<_.value.length;f++)if(_.value[f].id===r.id){_.value[f]=r,we(),b();break}},R=()=>{G.value=Ke(_.value),Y.value=!1,c.value=[],_.value=[],U.value="",v.value.delLocalMainPassword()},O=()=>{v.value.verifyMainPassword()},W=r=>{let f=r.name+`\r
`;r.address&&(f+=y("password.address")+": "+r.address+`\r
`),r.userName&&(f+=y("password.userName")+": "+r.userName+`\r
`),r.password&&(f+=y("password.password")+": "+r.password+`\r
`),r.remark&&(f+=r.remark+`\r
`),f=f.substring(0,f.length-2),Ge(f)},F=r=>{for(let f=0;f<_.value.length;f++)if(_.value[f].id===r.id){_.value.splice(f,1),we(),b(),oe.success(y("index.table.delete.success"));break}},K=r=>{U.value=r,_.value=xt(G.value),Y.value=!0,b()},Ee=(r,f)=>{U.value=r,N.value=f,we(),oe.success(y("index.mainPassword.changeSuccess"))},Fe=()=>{S.value.openSystemSetting()},De=()=>{w.value.updateMainPassword()},Ue=(r,f)=>{u[r]=f,r==="sortChange"&&Re(f)},Re=r=>{r==="insertTimeDesc"?(n.value.sort("insertTime","descending"),i("insertTime",-1)):r==="insertTimeAsc"?(n.value.sort("insertTime","ascending"),i("insertTime",1)):r==="updateTimeDesc"?(n.value.sort("updateTime","descending"),i("updateTime",-1)):r==="updateTimeAsc"?(n.value.sort("updateTime","ascending"),i("updateTime",1)):r==="nameAsc"?(n.value.sort("name","ascending"),i("name",1)):r==="nameDesc"?(n.value.sort("name","descending"),i("name",-1)):r==="strengthDesc"?(n.value.sort("strength","descending"),i("strength",-1)):r==="strengthAsc"&&(n.value.sort("strength","ascending"),i("strength",1)),we()},_e=(r,f)=>be(r.password)>be(f.password)?1:-1,ye=r=>{let f=0;for(let A=0;A<_.value.length;A++){if(!_.value[A].password)continue;let B=be(_.value[A].password);r===B&&f++}return f},i=(r,f)=>{_.value.sort((A,B)=>r==="strength"?f>0?_e(A,B):_e(B,A):(A=A[r],B=B[r],A<B?f*-1:A>B?f*1:0))},we=()=>{if(!Y.value)return;for(let f in _.value)delete _.value[f].show;G.value=Ke(_.value);let r=Pe(U.value,"password-x");ae.commit("setVerifyCode",r),ut("password.json",{verifyValue:r,mainPasswordType:N.value,passwordCiphertext:G.value})},pt=()=>{mt("password.json").then(r=>{if(r.verifyValue){let f=r.verifyValue;N.value=r.mainPasswordType||"common",ae.commit("setVerifyCode",f),ae.commit("setMainPasswordType",N.value),G.value=r.passwordCiphertext,v.value.verifyMainPassword(!0)}else Y.value=!0,w.value.settingMainPassword()}).catch(r=>{console.error(r),ot.error("error-1000："+r)})},ft=r=>{d.value=r,b()},wt=r=>{s.value=r},gt=r=>{console.log(r)},bt=r=>{if(!r)return"";let f=[];return Je(s.value,r,f),f},He=r=>r&&r.length===19?r.substring(0,16):r,Je=(r,f,A)=>{for(let B=0;B<r.length;B++)f.includes(r[B].id)&&A.push(r[B].label),r[B].children&&r[B].children.length>0&&Je(r[B].children,f,A)},_t=()=>{V.value.downloadExcelTemplate()},yt=()=>{V.value.importExcel(s.value)},vt=()=>{V.value.exportExcel(_.value,s.value)},ht=(r,f)=>{if(r.length!==0){for(let A=r.length-1;A>=0;A--)_.value.unshift(r[A]);o.value.setLabelTree(f),we(),b()}},kt=()=>{S.value.logout()},Pt=()=>J.value,Ke=r=>{if(r.length===0)return;let f={},A=[],B=0;for(let X=0;X<r.length;X++){let Z=[];for(let Q in r[X]){let se=f[Q];se===void 0&&(f[Q]=B++,se=f[Q]),Z[se]=r[X][Q]}A.push(Z)}return Pe(U.value,JSON.stringify({keys:f,datas:A}))},xt=r=>{if(!r)return[];let f=JSON.parse(me(U.value,r));if(f instanceof Array)return f;let A=f.datas,B=f.keys,X=[];for(let Z=0;Z<A.length;Z++){let Q=A[Z],se={};for(let re in B)se[re]=Q[B[re]];X.push(se)}return X};return nt(()=>{let r=$e();for(let f in r)u[f]=r[f];u.language&&u.language!==x.value&&(x.value=u.language),pt()}),(r,f)=>{const A=st,B=pe,X=fe,Z=Gt,Q=Bt,se=Yt,re=Wt,ne=jt,ee=Ot,ge=Ce,Le=Kt,Ae=Ht,Ie=Jt,St=je,Xe=Ye,Ct=Tl,Vt=We,Tt=Pl,Mt=ct,Et=hl,Ft=bl,Dt=ul;return g(),j(H,null,[Ml,l(Vt,{id:"passwordBody"},{default:t(()=>[l(Xe,{xl:{span:e(u).enableLabel?16:20,offset:2},lg:{span:e(u).enableLabel?19:24},md:{span:e(u).enableLabel?19:24}},{default:t(()=>[l(St,{class:"body-card",style:dt({"background-color":Pt()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[$("div",El,[$("div",null,[$("div",Fl,[e(_)?(g(),E(A,{key:0,class:"password-table-title"},{default:t(()=>[P(h(e(_).length)+" "+h(e(y)("index.title.passwordCount")),1)]),_:1})):z("",!0),Dl,e(u).showPasswordStrength?(g(),j("div",Ul,[l(A,{class:"password-table-strength"},{default:t(()=>[P(h(e(y)("index.title.strength"))+"（ ",1),l(A,{type:"success"},{default:t(()=>[P(h(e(y)("index.title.strength.strong")),1)]),_:1}),P(" : "+h(ye(3))+" ",1),l(A,{style:{"margin-left":"5px"},type:"warning"},{default:t(()=>[P(h(e(y)("index.title.strength.medium")),1)]),_:1}),P(" : "+h(ye(2))+" ",1),l(A,{style:{"margin-left":"5px"},type:"danger"},{default:t(()=>[P(h(e(y)("index.title.strength.weak")),1)]),_:1}),P(" : "+h(ye(1))+"） ",1)]),_:1})])):z("",!0)])]),$("div",Rl,[$("div",null,[l(B,{modelValue:e(k),"onUpdate:modelValue":f[0]||(f[0]=I=>ue(k)?k.value=I:null),style:{"max-width":"300px"},clearable:"",onClear:b,placeholder:e(y)("index.title.search"),"prefix-icon":e(sl),disabled:!e(U),onKeyup:[a,rt(b,["enter"])]},null,8,["modelValue","placeholder","prefix-icon","disabled","onKeyup"])]),$("div",null,[l(X,{disabled:!e(U)||!e(Y),type:"primary",plain:"",onClick:f[1]||(f[1]=I=>D())},{default:t(()=>[P(h(e(y)("index.title.addPassword")),1)]),_:1},8,["disabled"])]),$("div",null,[e(U)?z("",!0):(g(),E(Z,{key:0,content:e(y)("index.title.unlock"),effect:"dark",placement:"top"},{default:t(()=>[l(X,{disabled:!e(G),icon:e(ol),onClick:O},null,8,["disabled","icon"])]),_:1},8,["content"])),e(U)?(g(),E(Z,{key:1,content:e(y)("index.title.lock"),effect:"dark",placement:"top"},{default:t(()=>[l(X,{icon:e(et),onClick:R},null,8,["icon"])]),_:1},8,["content"])):z("",!0)]),l(re,null,{dropdown:t(()=>[l(se,null,{default:t(()=>[l(Q,{onClick:Fe},{default:t(()=>[P(h(e(y)("systemSetting.title")),1)]),_:1}),l(Q,{divided:"",onClick:yt},{default:t(()=>[P(h(e(y)("index.title.importExport.import")),1)]),_:1}),l(Q,{onClick:vt},{default:t(()=>[P(h(e(y)("index.title.importExport.export")),1)]),_:1}),l(Q,{onClick:_t},{default:t(()=>[P(h(e(y)("index.title.importExport.download")),1)]),_:1}),l(Q,{divided:"",onClick:kt},{default:t(()=>[P(h(e(y)("index.title.logout")),1)]),_:1})]),_:1})]),default:t(()=>[l(X,{icon:e(nl)},null,8,["icon"])]),_:1})])])]),default:t(()=>[l(Ie,{height:"calc(100vh - 130px)",style:{"background-color":"rgba(0,0,0,0)"},"header-row-style":{"background-color":"rgba(0,0,0,0)"},"header-cell-style":{"background-color":"rgba(0,0,0,0)"},"row-style":{"background-color":"rgba(0,0,0,0)"},"cell-style":{"background-color":"rgba(0,0,0,0)"},data:e(c),ref_key:"tableRef",ref:n},{empty:t(()=>[l(ne,{description:e(U)?e(y)("index.table.empty"):e(y)("index.table.lock")},Te({default:t(()=>[e(U)?z("",!0):(g(),E(X,{key:0,onClick:O,plain:"",type:"primary"},{default:t(()=>[P(h(e(y)("index.title.unlock")),1)]),_:1}))]),_:2},[e(U)?void 0:{name:"image",fn:t(()=>[l(e(et))]),key:"0"}]),1032,["description"])]),default:t(()=>[e(u).showPasswordStrength?(g(),E(ee,{key:0,sortable:"","sort-method":_e,prop:"strength",width:"30px"},{default:t(I=>[e(be)(I.row.password)===3?(g(),E(Z,{key:0},{content:t(()=>[P(h(e(y)("index.title.strength")+"："+e(y)("index.title.strength.strong")),1)]),default:t(()=>[Ll]),_:1})):z("",!0),e(be)(I.row.password)===2?(g(),E(Z,{key:1},{content:t(()=>[P(h(e(y)("index.title.strength")+"："+e(y)("index.title.strength.medium")),1)]),default:t(()=>[Al]),_:1})):z("",!0),e(be)(I.row.password)===1?(g(),E(Z,{key:2},{content:t(()=>[P(h(e(y)("index.title.strength")+"："+e(y)("index.title.strength.weak")),1)]),default:t(()=>[Il]),_:1})):z("",!0)]),_:1})):z("",!0),l(ee,{sortable:"",label:e(y)("password.name"),"min-width":"130px",prop:"name"},null,8,["label"]),l(ee,{label:e(y)("password.address"),"min-width":"200px",prop:"address"},{default:t(I=>[e(tl)(I.row.address)?(g(),E(ge,{key:0,href:I.row.address,target:"_blank"},{default:t(()=>[P(h(I.row.address),1)]),_:2},1032,["href"])):(g(),E(A,{key:1},{default:t(()=>[P(h(I.row.address),1)]),_:2},1024))]),_:1},8,["label"]),l(ee,{label:e(y)("password.userName"),"min-width":"140px",prop:"userName"},null,8,["label"]),l(ee,{label:e(y)("password.password"),"min-width":"180px",prop:"password"},{default:t(I=>[I.row.password?(g(),j("div",Nl,[$("span",zl,[I.row.show?z("",!0):(g(),j(H,{key:0},[P("•••••••••")],64)),I.row.show?(g(),j(H,{key:1},[P(h(I.row.password),1)],64)):z("",!0)]),$("div",$l,[I.row.show?z("",!0):(g(),E(e(rl),{key:0,onClick:de=>I.row.show=!I.row.show},null,8,["onClick"])),I.row.show?(g(),E(e(dl),{key:1,onClick:de=>I.row.show=!I.row.show},null,8,["onClick"])):z("",!0),l(e(il),{onClick:de=>e(Ge)(I.row.password)},null,8,["onClick"])])])):z("",!0)]),_:1},8,["label"]),e(u).enableLabel!==!1&&e(u).showLabel!==!1?(g(),E(ee,{key:1,label:e(y)("index.table.label"),"min-width":"130px",onDrop:gt,prop:"label"},{default:t(I=>[(g(!0),j(H,null,te(bt(I.row.label),de=>(g(),E(Le,{style:{margin:"3px"},key:de},{default:t(()=>[P(h(de),1)]),_:2},1024))),128))]),_:1},8,["label"])):z("",!0),l(ee,{label:e(y)("password.remark"),"min-width":"130px",prop:"remark"},null,8,["label"]),e(u).showAddTime?(g(),E(ee,{key:2,sortable:"",label:e(y)("password.insertTime"),width:"145px",prop:"insertTime"},{default:t(I=>[P(h(He(I.row.insertTime)),1)]),_:1},8,["label"])):z("",!0),e(u).showUpTime?(g(),E(ee,{key:3,sortable:"",label:e(y)("password.updateTime"),width:"145px",prop:"updateTime"},{default:t(I=>[P(h(He(I.row.updateTime)),1)]),_:1},8,["label"])):z("",!0),l(ee,{width:"135px",label:e(y)("index.table.operation")},{default:t(I=>[l(ge,{type:"success",underline:!1,onClick:de=>W(I.row)},{default:t(()=>[P(h(e(y)("index.table.share")),1)]),_:2},1032,["onClick"]),l(ge,{underline:!1,style:{"margin-left":"10px"},type:"primary",onClick:de=>p(I.row)},{default:t(()=>[P(h(e(y)("index.table.edit")),1)]),_:2},1032,["onClick"]),l(Ae,{title:e(y)("index.table.operation.affirmDelete"),"confirm-button-text":e(y)("index.table.operation.affirm"),"cancel-button-text":e(y)("index.table.operation.cancel"),onConfirm:de=>F(I.row)},{reference:t(()=>[l(ge,{style:{"margin-left":"10px"},underline:!1,type:"danger"},{default:t(()=>[P(h(e(y)("index.table.operation.delete")),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","onConfirm"])]),_:1},8,["label"])]),_:1},8,["header-row-style","header-cell-style","row-style","cell-style","data"])]),_:1},8,["style"])]),_:1},8,["xl","lg","md"]),e(u).enableLabel?(g(),E(Xe,{key:0,xl:{span:4},lg:{span:5},md:{span:5},class:"hidden-sm-and-down",style:{"padding-left":"15px"}},{default:t(()=>[l(Ct,{ref_key:"labelTreeRef",ref:o,onLabelCheckChange:ft,onLabelTreeChange:wt},null,512)]),_:1})):z("",!0)]),_:1}),l(Tt,{ref_key:"passwordFormRef",ref:M,labelTree:e(s),onAddPassword:C,onUpdatePassword:L},null,8,["labelTree"]),l(Mt,{ref_key:"mainPasswordVerifyRef",ref:v,onVerifyPass:K},null,512),l(Et,{ref_key:"mainPasswordSettingRef",ref:w,onMainPasswordChange:Ee},null,512),l(Ft,{ref_key:"systemSettingRef",ref:S,onUpdateMainPassword:De,onSystemChangeChange:Ue},null,512),l(Dt,{ref_key:"importExportRef",ref:V,labelTree:e(s),onImportComplete:ht},null,8,["labelTree"])],64)}}},ma=it(Gl,[["__scopeId","data-v-6ce3fc80"]]);export{ma as default};
